<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTech Lab - Pensiero Computazionale</title>
    <meta name="description" content="Piattaforma di Pensiero Computazionale per la Scuola Primaria">
    <meta name="theme-color" content="#3B82F6">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        // NEW GAME FUNCTIONS - FASE 3

        // Fraction Game Functions
        function generateFractionChallenge() {
            const denominators = [2, 3, 4, 6, 8];
            const denominator = denominators[Math.floor(Math.random() * denominators.length)];
            const numerator = Math.floor(Math.random() * denominator) + 1;
            
            fractionData = { numerator, denominator };
            
            document.getElementById('fraction-total').textContent = denominator;
            document.getElementById('fraction-display').textContent = '?';
            document.getElementById('fraction-input').value = '';
            document.getElementById('fraction-feedback').textContent = '';
            
            generateFractionVisual();
        }

        function generateFractionVisual() {
            const visualContainer = document.getElementById('fraction-visual');
            visualContainer.innerHTML = '';
            
            // Create pizza circles
            for (let pizza = 0; pizza < 2; pizza++) {
                const pizzaDiv = document.createElement('div');
                pizzaDiv.style.display = 'flex';
                pizzaDiv.style.flexDirection = 'column';
                pizzaDiv.style.alignItems = 'center';
                pizzaDiv.style.margin = '0 20px';
                
                const pizzaLabel = document.createElement('div');
                pizzaLabel.textContent = `Pizza ${pizza + 1}`;
                pizzaLabel.style.fontSize = '1rem';
                pizzaLabel.style.marginBottom = '10px';
                pizzaLabel.style.fontWeight = 'bold';
                pizzaDiv.appendChild(pizzaLabel);
                
                const circle = document.createElement('div');
                circle.className = 'fraction-circle';
                
                // Calculate slice angle
                const sliceAngle = 360 / fractionData.denominator;
                
                for (let i = 0; i < fractionData.denominator; i++) {
                    const slice = document.createElement('div');
                    slice.className = 'fraction-slice';
                    slice.style.transform = `rotate(${i * sliceAngle}deg)`;
                    
                    // Color first numerator slices if this is pizza 1
                    if (pizza === 0 && i < fractionData.numerator) {
                        slice.style.background = '#F59E0B';
                    } else {
                        slice.style.background = 'transparent';
                        slice.style.border = '2px solid #D97706';
                    }
                    
                    circle.appendChild(slice);
                }
                
                pizzaDiv.appendChild(circle);
                visualContainer.appendChild(pizzaDiv);
            }
            
            document.getElementById('fraction-question').textContent = `Quante parti sono colorate nella Pizza 1?`;
        }

        function checkFractionAnswer() {
            const userAnswer = parseInt(document.getElementById('fraction-input').value);
            const isCorrect = userAnswer === fractionData.numerator;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('fraction-feedback');
            
            if (isCorrect) {
                document.getElementById('fraction-display').textContent = fractionData.numerator;
                feedbackEl.textContent = `ðŸ• Bravissimo! La frazione Ã¨ ${fractionData.numerator}/${fractionData.denominator}!`;
                feedbackEl.className = 'feedback success';
                
                updateScore(30);
                updateStars(4);
                
                setTimeout(() => generateFractionChallenge(), 2500);
            } else {
                feedbackEl.textContent = 'ðŸ¤— Conta le parti colorate nella Pizza 1!';
                feedbackEl.className = 'feedback error';
            }
        }

        // Variables Game Functions
        function generateVariableChallenge() {
            const scenarios = [
                {
                    title: 'ðŸŽª Al Luna Park',
                    description: 'Calcola quanti biglietti puoi comprare!',
                    variables: [
                        { name: 'soldi', label: 'I tuoi soldi', value: Math.floor(Math.random() * 50) + 20, unit: 'â‚¬' },
                        { name: 'prezzo_biglietto', label: 'Prezzo biglietto', value: Math.floor(Math.random() * 8) + 3, unit: 'â‚¬' }
                    ],
                    calculation: 'soldi Ã· prezzo_biglietto',
                    question: 'Quanti biglietti puoi comprare?'
                },
                {
                    title: 'ðŸ• Pizzeria',
                    description: 'Calcola il costo totale!',
                    variables: [
                        { name: 'pizze', label: 'Numero pizze', value: Math.floor(Math.random() * 6) + 2, unit: '' },
                        { name: 'prezzo_pizza', label: 'Prezzo per pizza', value: Math.floor(Math.random() * 5) + 8, unit: 'â‚¬' }
                    ],
                    calculation: 'pizze Ã— prezzo_pizza',
                    question: 'Quanto costi in totale?'
                },
                {
                    title: 'ðŸš— Viaggio',
                    description: 'Calcola quanto tempo ci vuole!',
                    variables: [
                        { name: 'distanza', label: 'Distanza', value: Math.floor(Math.random() * 200) + 100, unit: 'km' },
                        { name: 'velocita', label: 'VelocitÃ ', value: Math.floor(Math.random() * 30) + 50, unit: 'km/h' }
                    ],
                    calculation: 'distanza Ã· velocita',
                    question: 'Quante ore di viaggio?'
                }
            ];
            
            variableData = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            document.getElementById('variable-scenario').textContent = variableData.title;
            document.getElementById('variable-description').textContent = variableData.description;
            document.getElementById('variable-calculation').textContent = variableData.calculation + ' = ?';
            document.getElementById('variable-result').value = '';
            document.getElementById('variable-feedback').textContent = '';
            
            updateVariableDisplay();
        }

        function updateVariableDisplay() {
            const container = document.getElementById('variable-containers');
            container.innerHTML = '';
            
            variableData.variables.forEach(variable => {
                const varDiv = document.createElement('div');
                varDiv.className = 'variable-container';
                varDiv.innerHTML = `
                    <h4 style="font-size: 1.2rem; margin-bottom: 1rem;">ðŸ“¦ ${variable.label}</h4>
                    <input type="number" 
                           value="${variable.value}" 
                           class="variable-input" 
                           onchange="updateVariableValue('${variable.name}', this.value)">
                    <div style="margin-top: 0.5rem; font-weight: bold;">${variable.unit}</div>
                `;
                container.appendChild(varDiv);
            });
        }

        function updateVariableValue(name, value) {
            const variable = variableData.variables.find(v => v.name === name);
            if (variable) {
                variable.value = parseInt(value) || 0;
            }
        }

        function checkVariableAnswer() {
            const userAnswer = parseInt(document.getElementById('variable-result').value);
            let correctAnswer;
            
            const vars = variableData.variables;
            if (variableData.calculation.includes('Ã·')) {
                correctAnswer = Math.floor(vars[0].value / vars[1].value);
            } else if (variableData.calculation.includes('Ã—')) {
                correctAnswer = vars[0].value * vars[1].value;
            }
            
            const isCorrect = userAnswer === correctAnswer;
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('variable-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = `ðŸ“¦ Perfetto! Il risultato Ã¨ ${correctAnswer}!`;
                feedbackEl.className = 'feedback success';
                
                updateScore(35);
                updateStars(4);
                
                setTimeout(() => generateVariableChallenge(), 2500);
            } else {
                feedbackEl.textContent = `ðŸ¤” Prova ancora! Usa i valori nelle variabili per calcolare.`;
                feedbackEl.className = 'feedback error';
            }
        }

        // Optimization Game Functions
        function generateOptimizationChallenge() {
            const challenges = [
                {
                    title: 'Trova il numero piÃ¹ grande',
                    question: 'Devi trovare il numero piÃ¹ grande in una lista di 1000 numeri',
                    slow: [
                        '1. Confronta il primo con tutti gli altri',
                        '2. Confronta il secondo con tutti gli altri',
                        '3. Confronta il terzo con tutti gli altri',
                        '4. Continua fino alla fine...',
                        'â±ï¸ Risultato: 500,000 confronti!'
                    ],
                    fast: [
                        '1. Ricorda il primo numero come "massimo"',
                        '2. Confronta ogni numero con il "massimo"',
                        '3. Se Ã¨ piÃ¹ grande, diventa il nuovo "massimo"',
                        '4. Continua fino alla fine',
                        'âš¡ Risultato: solo 1000 confronti!'
                    ]
                },
                {
                    title: 'Cercare una parola nel dizionario',
                    question: 'Devi trovare una parola in un dizionario di 1000 pagine',
                    slow: [
                        '1. Inizia dalla prima pagina',
                        '2. Leggi tutte le parole della pagina',
                        '3. Se non la trovi, vai alla pagina successiva',
                        '4. Continua fino a trovarla...',
                        'â±ï¸ Risultato: potrebbero volerci 500 pagine!'
                    ],
                    fast: [
                        '1. Apri il dizionario a metÃ ',
                        '2. La parola Ã¨ prima o dopo questa pagina?',
                        '3. Scegli la metÃ  giusta e ripeti',
                        '4. Continua a dimezzare...',
                        'âš¡ Risultato: solo 10 tentativi massimo!'
                    ]
                },
                {
                    title: 'Ordinare i compiti della classe',
                    question: 'Devi mettere in ordine 30 compiti per voto',
                    slow: [
                        '1. Trova il voto piÃ¹ alto tra tutti',
                        '2. Mettilo da parte',
                        '3. Trova il voto piÃ¹ alto tra quelli rimasti',
                        '4. Ripeti fino alla fine...',
                        'â±ï¸ Risultato: molti confronti ripetuti!'
                    ],
                    fast: [
                        '1. Dividi i compiti in due gruppi',
                        '2. Ordina ciascun gruppo separatamente',
                        '3. Unisci i due gruppi ordinati',
                        '4. Fatto!',
                        'âš¡ Risultato: molto piÃ¹ veloce!'
                    ]
                }
            ];
            
            optimizationData = challenges[Math.floor(Math.random() * challenges.length)];
            
            document.getElementById('optimization-title').textContent = optimizationData.title;
            document.getElementById('optimization-question').textContent = optimizationData.question;
            
            const slowEl = document.getElementById('slow-algorithm');
            slowEl.innerHTML = '';
            optimizationData.slow.forEach(step => {
                const stepEl = document.createElement('div');
                stepEl.textContent = step;
                stepEl.style.marginBottom = '0.5rem';
                slowEl.appendChild(stepEl);
            });
            
            const fastEl = document.getElementById('fast-algorithm');
            fastEl.innerHTML = '';
            optimizationData.fast.forEach(step => {
                const stepEl = document.createElement('div');
                stepEl.textContent = step;
                stepEl.style.marginBottom = '0.5rem';
                fastEl.appendChild(stepEl);
            });
            
            document.getElementById('optimization-feedback').textContent = '';
        }

        function checkOptimizationAnswer(choice) {
            const isCorrect = choice === 'fast';
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('optimization-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'ðŸš€ Perfetto! L\'algoritmo veloce Ã¨ sempre meglio per grandi quantitÃ  di dati!';
                feedbackEl.className = 'feedback success';
                
                updateScore(40);
                updateStars(5);
                
                setTimeout(() => generateOptimizationChallenge(), 3000);
            } else {
                feedbackEl.textContent = 'ðŸ¤” Pensa: quale algoritmo funzionerebbe meglio con 1 milione di elementi?';
                feedbackEl.className = 'feedback error';
            }
        }

        // Statistics Game Functions
        function generateStatisticsChallenge() {
            const datasets = [
                {
                    title: 'Sport Preferiti della Classe',
                    data: [
                        { label: 'Calcio', value: Math.floor(Math.random() * 10) + 5 },
                        { label: 'Basket', value: Math.floor(Math.random() * 8) + 3 },
                        { label: 'Tennis', value: Math.floor(Math.random() * 6) + 2 },
                        { label: 'Nuoto', value: Math.floor(Math.random() * 7) + 4 }
                    ],
                    questions: [
                        'Quale sport ha piÃ¹ voti?',
                        'Quale sport ha meno voti?',
                        'Quanti voti ha il calcio?'
                    ]
                },
                {
                    title: 'Animali Preferiti',
                    data: [
                        { label: 'Cani', value: Math.floor(Math.random() * 12) + 8 },
                        { label: 'Gatti', value: Math.floor(Math.random() * 10) + 6 },
                        { label: 'Pesci', value: Math.floor(Math.random() * 5) + 2 },
                        { label: 'Uccelli', value: Math.floor(Math.random() * 6) + 3 }
                    ],
                    questions: [
                        'Quale animale Ã¨ piÃ¹ amato?',
                        'Quale animale ha meno preferenze?',
                        'Quanti voti hanno i cani?'
                    ]
                },
                {
                    title: 'Colori Preferiti',
                    data: [
                        { label: 'Blu', value: Math.floor(Math.random() * 9) + 6 },
                        { label: 'Rosso', value: Math.floor(Math.random() * 8) + 4 },
                        { label: 'Verde', value: Math.floor(Math.random() * 7) + 5 },
                        { label: 'Giallo', value: Math.floor(Math.random() * 6) + 3 }
                    ],
                    questions: [
                        'Quale colore piace di piÃ¹?',
                        'Quale colore ha meno voti?',
                        'Quanti voti ha il blu?'
                    ]
                }
            ];
            
            statisticsData = datasets[Math.floor(Math.random() * datasets.length)];
            const questionIndex = Math.floor(Math.random() * statisticsData.questions.length);
            statisticsData.currentQuestion = statisticsData.questions[questionIndex];
            
            document.getElementById('statistics-title').textContent = statisticsData.title;
            document.getElementById('statistics-question').textContent = statisticsData.currentQuestion;
            document.getElementById('statistics-input').value = '';
            document.getElementById('statistics-feedback').textContent = '';
            
            generateStatisticsChart();
        }

        function generateStatisticsChart() {
            const chartContainer = document.getElementById('statistics-chart');
            chartContainer.innerHTML = '';
            
            const maxValue = Math.max(...statisticsData.data.map(d => d.value));
            
            statisticsData.data.forEach(item => {
                const barDiv = document.createElement('div');
                barDiv.className = 'chart-bar';
                
                const height = (item.value / maxValue) * 200;
                barDiv.style.height = height + 'px';
                
                const valueEl = document.createElement('div');
                valueEl.className = 'bar-value';
                valueEl.textContent = item.value;
                barDiv.appendChild(valueEl);
                
                const labelEl = document.createElement('div');
                labelEl.className = 'bar-label';
                labelEl.textContent = item.label;
                barDiv.appendChild(labelEl);
                
                chartContainer.appendChild(barDiv);
            });
        }

        function checkStatisticsAnswer() {
            const userAnswer = document.getElementById('statistics-input').value.toLowerCase().trim();
            let correctAnswer = '';
            
            if (statisticsData.currentQuestion.includes('piÃ¹') || statisticsData.currentQuestion.includes('maggior')) {
                const max = Math.max(...statisticsData.data.map(d => d.value));
                correctAnswer = statisticsData.data.find(d => d.value === max).label.toLowerCase();
            } else if (statisticsData.currentQuestion.includes('meno') || statisticsData.currentQuestion.includes('minor')) {
                const min = Math.min(...statisticsData.data.map(d => d.value));
                correctAnswer = statisticsData.data.find(d => d.value === min).label.toLowerCase();
            } else {
                // Numeric answer
                const numericAnswers = statisticsData.data.filter(d => 
                    statisticsData.currentQuestion.toLowerCase().includes(d.label.toLowerCase()));
                if (numericAnswers.length > 0) {
                    correctAnswer = numericAnswers[0].value.toString();
                }
            }
            
            const isCorrect = userAnswer === correctAnswer || parseInt(userAnswer) === parseInt(correctAnswer);
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('statistics-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'ðŸ“Š Perfetto! Sai leggere i grafici!';
                feedbackEl.className = 'feedback success';
                
                updateScore(35);
                updateStars(4);
                
                setTimeout(() => generateStatisticsChallenge(), 2500);
            } else {
                feedbackEl.textContent = `ðŸ¤” Guarda bene le altezze delle barre! La risposta Ã¨: ${correctAnswer}`;
                feedbackEl.className = 'feedback info';
            }
        }

        // Projects Game Functions
        function generateProjectChallenge() {
            const projects = [
                {
                    name: 'ðŸŽ® Gioco del Memory',
                    steps: [
                        { name: 'Progettazione', icon: 'ðŸŽ¨', description: 'Stai progettando l\'interfaccia utente del gioco...' },
                        { name: 'Contenuti', icon: 'ðŸ“', description: 'Stai creando le carte e i contenuti del memory...' },
                        { name: 'Programmazione', icon: 'ðŸ’»', description: 'Stai scrivendo il codice per la logica del gioco...' },
                        { name: 'Testing', icon: 'ðŸ§ª', description: 'Stai testando il gioco per trovare eventuali bug...' },
                        { name: 'Pubblicazione', icon: 'ðŸš€', description: 'Stai pubblicando il gioco online!' }
                    ]
                },
                {
                    name: 'ðŸ“± App per Studiare',
                    steps: [
                        { name: 'Ricerca', icon: 'ðŸ”', description: 'Stai studiando come fanno gli studenti a imparare meglio...' },
                        { name: 'Design', icon: 'ðŸŽ¨', description: 'Stai disegnando come apparirÃ  l\'app...' },
                        { name: 'Sviluppo', icon: 'âš™ï¸', description: 'Stai programmando tutte le funzioni dell\'app...' },
                        { name: 'Test Utenti', icon: 'ðŸ‘¥', description: 'Stai facendo provare l\'app ad altri studenti...' },
                        { name: 'Lancio', icon: 'ðŸŽ‰', description: 'Stai pubblicando l\'app sugli store!' }
                    ]
                },
                {
                    name: 'ðŸŒ Sito della Scuola',
                    steps: [
                        { name: 'Pianificazione', icon: 'ðŸ“‹', description: 'Stai decidendo che informazioni mettere nel sito...' },
                        { name: 'Grafica', icon: 'ðŸŽ¨', description: 'Stai creando logo, colori e immagini...' },
                        { name: 'Codifica', icon: 'ðŸ’»', description: 'Stai scrivendo il codice HTML e CSS...' },
                        { name: 'Contenuti', icon: 'ðŸ“', description: 'Stai scrivendo tutti i testi e aggiungendo foto...' },
                        { name: 'Online', icon: 'ðŸŒ', description: 'Stai mettendo il sito online!' }
                    ]
                }
            ];
            
            projectData = projects[Math.floor(Math.random() * projects.length)];
            projectData.currentStep = 0;
            
            document.getElementById('project-name').textContent = projectData.name;
            document.getElementById('total-steps').textContent = projectData.steps.length;
            
            updateProjectDisplay();
        }

        function updateProjectDisplay() {
            const progressPercent = ((projectData.currentStep + 1) / projectData.steps.length) * 100;
            document.getElementById('progress-fill').style.width = progressPercent + '%';
            document.getElementById('current-step').textContent = projectData.currentStep + 1;
            
            // Update current step info
            const currentStepData = projectData.steps[projectData.currentStep];
            document.getElementById('current-step-icon').textContent = currentStepData.icon;
            document.getElementById('current-step-name').textContent = currentStepData.name;
            document.getElementById('current-step-description').textContent = currentStepData.description;
            
            // Update steps list
            const stepsContainer = document.getElementById('project-steps');
            stepsContainer.innerHTML = '';
            
            projectData.steps.forEach((step, index) => {
                const stepEl = document.createElement('div');
                stepEl.className = 'project-step';
                
                if (index < projectData.currentStep) {
                    stepEl.classList.add('step-complete');
                } else if (index === projectData.currentStep) {
                    stepEl.classList.add('step-current');
                } else {
                    stepEl.classList.add('step-pending');
                }
                
                const icon = index < projectData.currentStep ? 'âœ…' : 
                            index === projectData.currentStep ? 'ðŸš§' : 'â³';
                
                stepEl.innerHTML = `
                    <span style="font-size: 1.5rem;">${icon}</span>
                    <span style="font-weight: bold;">${index + 1}. ${step.name}</span>
                `;
                
                stepsContainer.appendChild(stepEl);
            });
        }

        function advanceProjectStep() {
            if (projectData.currentStep < projectData.steps.length - 1) {
                projectData.currentStep++;
                updateProjectDisplay();
                
                const feedbackEl = document.getElementById('project-feedback');
                feedbackEl.textContent = `âš¡ Step completato! Ora lavori su: ${projectData.steps[projectData.currentStep].name}`;
                feedbackEl.className = 'feedback success';
                
                updateScore(25);
                updateStars(3);
                
                setTimeout(() => {
                    feedbackEl.textContent = '';
                }, 2000);
            } else {
                const feedbackEl = document.getElementById('project-feedback');
                feedbackEl.textContent = 'ðŸŽ‰ Progetto completato! Sei un vero sviluppatore!';
                feedbackEl.className = 'feedback success';
                
                updateScore(50);
                updateStars(5);
                
                setTimeout(() => generateProjectChallenge(), 3000);
            }
        }

        // Collaboration Game Functions
        function generateCollaborationChallenge() {
            const projects = [
                {
                    name: 'ðŸŒ Sito Web della Scuola',
                    roles: [
                        { name: 'Designer', icon: 'ðŸŽ¨', description: 'Stai creando mockup e interfacce belle da vedere...' },
                        { name: 'Programmatore', icon: 'ðŸ’»', description: 'Stai scrivendo il codice e implementando le funzioni...' },
                        { name: 'Tester', icon: 'ðŸ§ª', description: 'Stai cercando bug e testando tutte le funzionalitÃ ...' },
                        { name: 'Content Writer', icon: 'ðŸ“', description: 'Stai scrivendo i testi e preparando i contenuti...' }
                    ],
                    messages: [
                        'Designer: "Ho finito i mockup della homepage! ðŸŽ¨"',
                        'Programmatore: "Perfetto! Inizio a programmare subito ðŸ’»"',
                        'Tester: "Tutto funziona bene, ottimo lavoro team! ðŸ§ª"',
                        'Content Writer: "I testi sono pronti per la pubblicazione ðŸ“"'
                    ]
                },
                {
                    name: 'ðŸŽ® Videogioco Educativo',
                    roles: [
                        { name: 'Game Designer', icon: 'ðŸŽ¯', description: 'Stai progettando i livelli e le meccaniche di gioco...' },
                        { name: 'Artista', icon: 'ðŸŽ¨', description: 'Stai disegnando personaggi e ambientazioni...' },
                        { name: 'Programmatore', icon: 'âš™ï¸', description: 'Stai programmando il motore di gioco...' },
                        { name: 'Sound Designer', icon: 'ðŸŽµ', description: 'Stai creando musiche e effetti sonori...' }
                    ],
                    messages: [
                        'Game Designer: "Il gameplay Ã¨ bilanciato perfettamente! ðŸŽ¯"',
                        'Artista: "I personaggi sono pronti e coloratissimi! ðŸŽ¨"',
                        'Programmatore: "Il codice gira senza bug! âš™ï¸"',
                        'Sound Designer: "La colonna sonora Ã¨ epica! ðŸŽµ"'
                    ]
                },
                {
                    name: 'ðŸ“± App per la SostenibilitÃ ',
                    roles: [
                        { name: 'UX Designer', icon: 'ðŸ“', description: 'Stai progettando l\'esperienza utente dell\'app...' },
                        { name: 'Developer', icon: 'ðŸ“±', description: 'Stai sviluppando l\'app per smartphone...' },
                        { name: 'Data Scientist', icon: 'ðŸ“Š', description: 'Stai analizzando i dati ambientali...' },
                        { name: 'Marketing', icon: 'ðŸ“¢', description: 'Stai promuovendo l\'app per sensibilizzare le persone...' }
                    ],
                    messages: [
                        'UX Designer: "L\'interfaccia Ã¨ intuitiva e user-friendly! ðŸ“"',
                        'Developer: "L\'app Ã¨ veloce e stabile! ðŸ“±"',
                        'Data Scientist: "I dati mostrano un grande impatto positivo! ðŸ“Š"',
                        'Marketing: "La campagna sta avendo successo! ðŸ“¢"'
                    ]
                }
            ];
            
            collaborationData = projects[Math.floor(Math.random() * projects.length)];
            collaborationData.currentRole = 0;
            
            document.getElementById('collaboration-project').textContent = collaborationData.name;
            
            updateCollaborationDisplay();
        }

        function updateCollaborationDisplay() {
            // Update team roles
            const rolesContainer = document.getElementById('team-roles');
            rolesContainer.innerHTML = '';
            
            collaborationData.roles.forEach((role, index) => {
                const roleEl = document.createElement('div');
                roleEl.className = 'team-role';
                
                if (index < collaborationData.currentRole) {
                    roleEl.classList.add('role-complete');
                } else if (index === collaborationData.currentRole) {
                    roleEl.classList.add('role-active');
                } else {
                    roleEl.classList.add('role-pending');
                }
                
                const status = index < collaborationData.currentRole ? 'âœ… Completato' : 
                              index === collaborationData.currentRole ? 'ðŸš§ In corso' : 'â³ In attesa';
                
                roleEl.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">${role.icon}</div>
                    <div style="font-weight: bold; margin-bottom: 0.5rem;">${role.name}</div>
                    <div style="font-size: 0.9rem;">${status}</div>
                `;
                
                rolesContainer.appendChild(roleEl);
            });
            
            // Update current role info
            const currentRoleData = collaborationData.roles[collaborationData.currentRole];
            document.getElementById('current-role-icon').textContent = currentRoleData.icon;
            document.getElementById('current-role-name').textContent = currentRoleData.name;
            document.getElementById('current-role-description').textContent = currentRoleData.description;
            
            // Update chat messages
            const chatContainer = document.getElementById('chat-messages');
            chatContainer.innerHTML = '';
            
            for (let i = 0; i <= collaborationData.currentRole && i < collaborationData.messages.length; i++) {
                const messageEl = document.createElement('div');
                messageEl.className = 'chat-message';
                messageEl.textContent = collaborationData.messages[i];
                chatContainer.appendChild(messageEl);
            }
        }

        function advanceCollaborationStep() {
            if (collaborationData.currentRole < collaborationData.roles.length - 1) {
                collaborationData.currentRole++;
                updateCollaborationDisplay();
                
                const feedbackEl = document.getElementById('collaboration-feedback');
                feedbackEl.textContent = `ðŸ¤ Ottimo lavoro! Ora collabori come: ${collaborationData.roles[collaborationData.currentRole].name}`;
                feedbackEl.className = 'feedback success';
                
                updateScore(30);
                updateStars(4);
                
                setTimeout(() => {
                    feedbackEl.textContent = '';
                }, 2000);
            } else {
                const feedbackEl = document.getElementById('collaboration-feedback');
                feedbackEl.textContent = 'ðŸŽ‰ Progetto di squadra completato! Siete un team fantastico!';
                feedbackEl.className = 'feedback success';
                
                updateScore(60);
                updateStars(6);
                
                setTimeout(() => generateCollaborationChallenge(), 3000);
            }
        }

        // Progress and Stats Functions
        function updateScore(points) {
            score += points;
            updateStats();
        }

        function updateStars(newStars) {
            stars += newStars;
            updateStats();
        }

        function updateStats() {
            // Update all score displays
            document.querySelectorAll('[id$="-score"], #score-count').forEach(el => {
                el.textContent = score;
            });
            
            // Update all stars displays
            document.querySelectorAll('[id$="-stars"], #stars-count').forEach(el => {
                el.textContent = stars;
            });
            
            // Update level displays
            document.querySelectorAll('[id$="-level"], #level-count').forEach(el => {
                el.textContent = level;
            });
            
            // Save to localStorage
            localStorage.setItem('edutech_score', score.toString());
            localStorage.setItem('edutech_stars', stars.toString());
            localStorage.setItem('edutech_level', level.toString());
            
            // Show stats bar if progress made
            if (score > 0 || stars > 0) {
                document.getElementById('stats-bar').style.display = 'flex';
            }
        }

        function updateGameStats() {
            updateStats();
        }

        function updateAdaptiveStats(isCorrect) {
            adaptiveData.totalQuestions++;
            if (isCorrect) {
                adaptiveData.correctAnswers++;
                adaptiveData.consecutiveCorrect++;
                adaptiveData.consecutiveWrong = 0;
            } else {
                adaptiveData.consecutiveCorrect = 0;
                adaptiveData.consecutiveWrong++;
            }
            
            // Adjust difficulty
            if (isCorrect && adaptiveData.consecutiveCorrect >= 4) {
                adaptiveData.currentDifficulty = Math.min(5, adaptiveData.currentDifficulty + 1);
                adaptiveData.consecutiveCorrect = 0;
            } else if (!isCorrect && adaptiveData.consecutiveWrong >= 2) {
                adaptiveData.currentDifficulty = Math.max(1, adaptiveData.currentDifficulty - 1);
                adaptiveData.consecutiveWrong = 0;
            }
            
            // Update level based on adaptive difficulty
            level = adaptiveData.currentDifficulty;
            
            localStorage.setItem('edutech_adaptive', JSON.stringify(adaptiveData));
        }

        function resetProgress() {
            if (confirm('Sei sicuro di voler resettare tutti i progressi? (Utile per cambio classe)')) {
                score = 0;
                stars = 0;
                level = 1;
                adaptiveData = {
                    consecutiveCorrect: 0,
                    consecutiveWrong: 0,
                    totalQuestions: 0,
                    correctAnswers: 0,
                    currentDifficulty: 1
                };
                
                localStorage.removeItem('edutech_score');
                localStorage.removeItem('edutech_stars');
                localStorage.removeItem('edutech_level');
                localStorage.removeItem('edutech_adaptive');
                
                updateStats();
                document.getElementById('stats-bar').style.display = 'none';
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Add keyboard support for games
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                if (currentGame === 'addizioni-visual' || currentGame === 'tabelline-base') {
                    checkMathAnswer();
                } else if (currentGame === 'conteggio') {
                    checkCountingAnswer();
                } else if (currentGame === 'tabelline-complete') {
                    checkTabellinesAnswer();
                } else if (currentGame === 'frazioni-visual') {
                    checkFractionAnswer();
                } else if (currentGame === 'variabili-semplici') {
                    checkVariableAnswer();
                } else if (currentGame === 'statistica-base') {
                    checkStatisticsAnswer();
                }
            }
        });
    </script>
</body>
</html>
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #DBEAFE 0%, #D1FAE5 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            font-size: 3rem;
            color: #2563EB;
            margin-bottom: 1rem;
        }
        
        .header h2 {
            font-size: 1.5rem;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6B7280;
            font-size: 1.1rem;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-stars { background: #FEF3C7; color: #92400E; }
        .stat-score { background: #D1FAE5; color: #065F46; }
        .stat-level { background: #E0E7FF; color: #3730A3; }
        
        /* Navigation Buttons */
        .nav-btn {
            background: #F3F4F6;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-btn:hover {
            background: #E5E7EB;
            transform: translateY(-1px);
        }
        
        .reset-btn {
            background: #FEE2E2;
            color: #DC2626;
        }
        
        .reset-btn:hover {
            background: #FEF2F2;
        }
        
        /* Grid Layouts */
        .classes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        /* Cards */
        .class-card, .category-card, .game-card {
            background: linear-gradient(135deg, white 0%, #F9FAFB 100%);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #E5E7EB;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }
        
        .class-card:hover, .category-card:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .game-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .game-card.disabled:hover {
            transform: none;
        }
        
        .card-emoji {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1F2937;
            margin-bottom: 0.5rem;
        }
        
        .card-description {
            color: #6B7280;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .card-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .badge {
            background: #EFF6FF;
            color: #1E40AF;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge.math { background: #EFF6FF; color: #1E40AF; }
        .badge.coding { background: #ECFDF5; color: #059669; }
        .badge.thinking { background: #FAF5FF; color: #7C3AED; }
        
        /* Game Screen */
        .game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #DBEAFE 0%, #D1FAE5 100%);
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        
        .game-header {
            background: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .game-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563EB;
        }
        
        .game-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .game-area {
            background: white;
            border-radius: 2rem;
            padding: 3rem;
            max-width: 800px;
            width: 100%;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .question {
            font-size: 4rem;
            font-weight: bold;
            color: #1F2937;
            margin-bottom: 2rem;
        }
        
        .visual-objects {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            min-height: 200px;
        }
        
        .visual-object {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            transition: transform 0.2s;
        }
        
        .visual-object:hover {
            transform: scale(1.1);
        }
        
        .input-area {
            margin: 2rem 0;
        }
        
        .game-input {
            font-size: 3rem;
            text-align: center;
            border: 4px solid #3B82F6;
            border-radius: 1rem;
            padding: 1rem;
            width: 200px;
            margin-right: 1rem;
        }
        
        .game-btn {
            background: #10B981;
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0.5rem;
        }
        
        .game-btn:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .game-btn.secondary {
            background: #3B82F6;
        }
        
        .game-btn.secondary:hover {
            background: #2563EB;
        }
        
        .game-btn.yellow {
            background: #F59E0B;
        }
        
        .game-btn.yellow:hover {
            background: #D97706;
        }
        
        .game-btn.red {
            background: #EF4444;
        }
        
        .game-btn.red:hover {
            background: #DC2626;
        }
        
        .game-btn.purple {
            background: #8B5CF6;
        }
        
        .game-btn.purple:hover {
            background: #7C3AED;
        }
        
        .feedback {
            font-size: 2rem;
            font-weight: bold;
            padding: 1.5rem;
            border-radius: 1rem;
            margin: 1rem 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feedback.success {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .feedback.error {
            background: #FEE2E2;
            color: #DC2626;
        }
        
        .feedback.info {
            background: #FEF3C7;
            color: #92400E;
        }
        
        /* Pattern Game */
        .pattern-sequence {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .pattern-item {
            font-size: 4rem;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #F3F4F6;
            border: 4px solid #D1D5DB;
            border-radius: 1rem;
        }
        
        .pattern-item.missing {
            border-style: dashed;
            background: #FEF3C7;
        }
        
        .pattern-options {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }
        
        .pattern-option {
            font-size: 4rem;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 4px solid #D1D5DB;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pattern-option:hover {
            border-color: #3B82F6;
            transform: scale(1.1);
        }
        
        .pattern-option.selected {
            border-color: #10B981;
            background: #D1FAE5;
        }
        
        /* Sequence Game */
        .sequence-area {
            background: #F3F4F6;
            border: 4px solid #D1D5DB;
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            min-height: 120px;
        }
        
        .sequence-items {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .sequence-item {
            background: #EFF6FF;
            border: 2px solid #3B82F6;
            border-radius: 0.5rem;
            padding: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .sequence-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .sequence-option {
            background: #FEF3C7;
            border: 3px solid #F59E0B;
            border-radius: 1rem;
            padding: 1.5rem;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .sequence-option:hover {
            background: #FED7AA;
            transform: translateY(-2px);
        }

        /* Loop Game Styles */
        .loop-area {
            background: #F0F9FF;
            border: 4px solid #0284C7;
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
            min-height: 150px;
        }
        
        .loop-commands {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .loop-command {
            background: #0284C7;
            color: white;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* If-Then Game Styles */
        .condition-card {
            background: #FEF3C7;
            border: 4px solid #F59E0B;
            border-radius: 1.5rem;
            padding: 2rem;
            margin: 1rem 0;
            text-align: center;
        }

        .then-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .then-option {
            background: #DBEAFE;
            border: 3px solid #3B82F6;
            border-radius: 1rem;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .then-option:hover {
            background: #BFDBFE;
            transform: scale(1.05);
        }

        /* Debug Game Styles */
        .debug-sequence {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .debug-command {
            background: white;
            border: 4px solid #D1D5DB;
            border-radius: 1rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-width: 120px;
        }
        
        .debug-command:hover {
            border-color: #EF4444;
            transform: scale(1.05);
        }
        
        .debug-command.error {
            border-color: #EF4444;
            background: #FEE2E2;
            transform: scale(1.1);
        }

        /* Algorithm Game Styles */
        .algorithm-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-width: 300px;
            margin: 0 auto 2rem;
        }
        
        .grid-cell {
            width: 80px;
            height: 80px;
            border: 2px solid #D1D5DB;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: white;
        }
        
        .algorithm-solution {
            background: #F0F9FF;
            border: 4px solid #0284C7;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            min-height: 120px;
        }
        
        .solution-steps {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .solution-step {
            background: #DBEAFE;
            border: 2px solid #3B82F6;
            border-radius: 0.5rem;
            padding: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Fraction Game Styles */
        .fraction-visual {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .fraction-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid #D97706;
            position: relative;
            overflow: hidden;
            background: #FEF3C7;
        }
        
        .fraction-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            background: #F59E0B;
        }

        /* Variable Game Styles */
        .variable-containers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .variable-container {
            background: #EFF6FF;
            border: 4px solid #3B82F6;
            border-radius: 1.5rem;
            padding: 1.5rem;
            text-align: center;
        }
        
        .variable-input {
            font-size: 2rem;
            text-align: center;
            border: 3px solid #3B82F6;
            border-radius: 1rem;
            padding: 0.75rem;
            width: 120px;
            margin-top: 1rem;
        }

        /* Statistics Game Styles */
        .chart-container {
            background: white;
            border: 4px solid #8B5CF6;
            border-radius: 1.5rem;
            padding: 2rem;
            margin: 2rem 0;
            height: 300px;
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 1rem;
        }
        
        .chart-bar {
            background: #8B5CF6;
            border-radius: 0.5rem;
            min-width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s;
        }
        
        .bar-value {
            color: white;
            font-weight: bold;
            padding: 0.5rem;
            font-size: 1.2rem;
        }
        
        .bar-label {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            font-weight: bold;
            text-align: center;
            color: #374151;
        }

        /* Project Game Styles */
        .project-progress {
            background: #F3F4F6;
            border-radius: 1rem;
            height: 20px;
            margin: 2rem 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #F59E0B 0%, #D97706 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 1rem;
        }
        
        .project-steps {
            display: grid;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .project-step {
            padding: 1rem;
            border-radius: 1rem;
            border: 3px solid;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
        }
        
        .step-complete {
            background: #D1FAE5;
            border-color: #10B981;
        }
        
        .step-current {
            background: #FEF3C7;
            border-color: #F59E0B;
            transform: scale(1.05);
        }
        
        .step-pending {
            background: #F3F4F6;
            border-color: #D1D5DB;
        }

        /* Collaboration Game Styles */
        .team-roles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .team-role {
            padding: 1.5rem;
            border-radius: 1rem;
            border: 3px solid;
            text-align: center;
            transition: all 0.3s;
        }
        
        .role-active {
            background: #FEF3C7;
            border-color: #F59E0B;
            transform: scale(1.05);
        }
        
        .role-complete {
            background: #D1FAE5;
            border-color: #10B981;
        }
        
        .role-pending {
            background: #F3F4F6;
            border-color: #D1D5DB;
        }

        .chat-simulation {
            background: #F0F9FF;
            border: 3px solid #0284C7;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .chat-message {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #0284C7;
        }

        /* Footer */
        .footer {
            background: #1F2937;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
            border-radius: 1rem;
        }
        
        .footer h3 {
            color: #60A5FA;
            margin-bottom: 0.5rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .question { font-size: 2.5rem; }
            .game-input { font-size: 2rem; width: 150px; }
            .game-area { padding: 2rem; }
            .pattern-item, .pattern-option { font-size: 2.5rem; width: 80px; height: 80px; }
            .stats-bar { flex-direction: column; align-items: center; }
            .game-header-content { justify-content: center; text-align: center; }
            .grid-cell { width: 60px; height: 60px; font-size: 1.5rem; }
        }
        
        /* Hidden class */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- HOMEPAGE -->
        <div id="homepage" class="view">
            <div class="container">
                <header class="header">
                    <h1>ðŸŽ“ EduTech Lab</h1>
                    <h2>Pensiero Computazionale per la Scuola Primaria</h2>
                    <p>Scegli la tua classe e inizia il viaggio nel mondo del coding!</p>
                </header>

                <!-- Stats Bar (visible when there are points) -->
                <div id="stats-bar" class="stats-bar" style="display: none;">
                    <div class="stat-item stat-stars">â­ <span id="stars-count">0</span> stelle</div>
                    <div class="stat-item stat-score">ðŸ† <span id="score-count">0</span> punti</div>
                    <div class="stat-item stat-level">ðŸ§  Livello <span id="level-count">1</span></div>
                    <button class="nav-btn reset-btn" onclick="resetProgress()">ðŸ”„ Reset</button>
                </div>

        <!-- NEW GAMES - FASE 3 (Classi 4Âª e 5Âª) -->

        <!-- Fractions Game -->
        <div id="fractions-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ• Frazioni Interattive</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="fractions-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="fractions-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem;">ðŸ• Visualizza le Frazioni!</h3>
                    <p id="fraction-question" style="font-size: 1.5rem; margin-bottom: 2rem;">Quante parti sono colorate?</p>
                    <div id="fraction-visual" class="fraction-visual">
                        <!-- Pizza circles will be generated here -->
                    </div>
                    <div style="font-size: 1.3rem; margin: 2rem 0;">
                        Frazione: <span id="fraction-display">?</span> / <span id="fraction-total">?</span>
                    </div>
                    <div class="input-area">
                        <input type="number" id="fraction-input" class="game-input" placeholder="?" min="0">
                        <button class="game-btn" onclick="checkFractionAnswer()">âœ… Controlla</button>
                        <button class="game-btn secondary" onclick="generateFractionChallenge()">ðŸ”„ Nuova Frazione</button>
                    </div>
                    <div id="fraction-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Variables Game -->
        <div id="variables-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ“¦ Le Mie Prime Variabili</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="variables-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="variables-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="variable-scenario" style="font-size: 2rem; margin-bottom: 1rem;">ðŸŽª Al Luna Park</h3>
                    <p id="variable-description" style="font-size: 1.3rem; margin-bottom: 2rem;">Calcola quanti biglietti puoi comprare!</p>
                    <div id="variable-containers" class="variable-containers">
                        <!-- Variable containers will be generated here -->
                    </div>
                    <div style="background: #F0F9FF; padding: 2rem; border-radius: 1rem; margin: 2rem 0;">
                        <h4 style="font-size: 1.5rem; margin-bottom: 1rem;">ðŸ§® Calcolo:</h4>
                        <div id="variable-calculation" style="font-size: 1.3rem; margin-bottom: 1rem;">
                            soldi Ã· prezzo_biglietto = ?
                        </div>
                        <input type="number" id="variable-result" class="game-input" placeholder="Risultato" style="width: 150px;">
                    </div>
                    <div style="margin: 1rem 0;">
                        <button class="game-btn" onclick="checkVariableAnswer()">ðŸ§® Calcola!</button>
                        <button class="game-btn secondary" onclick="generateVariableChallenge()">ðŸ”„ Nuovo Scenario</button>
                    </div>
                    <div id="variable-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Optimization Game -->
        <div id="optimization-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸƒâ€â™‚ï¸ Algoritmi Veloci</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="optimization-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="optimization-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="optimization-title" style="font-size: 2rem; margin-bottom: 1rem;">Quale algoritmo Ã¨ piÃ¹ veloce?</h3>
                    <p id="optimization-question" style="font-size: 1.3rem; margin-bottom: 2rem;">Confronta due modi diversi di risolvere lo stesso problema</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                        <div style="background: #FEE2E2; border: 4px solid #EF4444; border-radius: 1.5rem; padding: 2rem;">
                            <h4 style="color: #DC2626; font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">ðŸŒ Algoritmo Lento</h4>
                            <div id="slow-algorithm" style="font-size: 1rem; line-height: 1.6;">
                                <!-- Slow algorithm steps -->
                            </div>
                            <div style="margin-top: 1rem; color: #DC2626; font-weight: bold; text-align: center;">
                                â±ï¸ Tempo: Molto lento
                            </div>
                        </div>
                        
                        <div style="background: #D1FAE5; border: 4px solid #10B981; border-radius: 1.5rem; padding: 2rem;">
                            <h4 style="color: #059669; font-size: 1.5rem; margin-bottom: 1rem; text-align: center;">ðŸš€ Algoritmo Veloce</h4>
                            <div id="fast-algorithm" style="font-size: 1rem; line-height: 1.6;">
                                <!-- Fast algorithm steps -->
                            </div>
                            <div style="margin-top: 1rem; color: #059669; font-weight: bold; text-align: center;">
                                âš¡ Tempo: Molto veloce
                            </div>
                        </div>
                    </div>

                    <h4 style="font-size: 1.5rem; margin: 2rem 0;">Quale algoritmo sceglieresti?</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <button class="game-btn red" onclick="checkOptimizationAnswer('slow')" style="font-size: 1.2rem; padding: 1.5rem;">
                            ðŸŒ Algoritmo Lento
                        </button>
                        <button class="game-btn" onclick="checkOptimizationAnswer('fast')" style="font-size: 1.2rem; padding: 1.5rem;">
                            ðŸš€ Algoritmo Veloce
                        </button>
                    </div>
                    
                    <button class="game-btn secondary" onclick="generateOptimizationChallenge()" style="margin-top: 1rem;">ðŸ”„ Nuova Sfida</button>
                    <div id="optimization-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Statistics Game -->
        <div id="statistics-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ“Š I Miei Primi Grafici</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="statistics-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="statistics-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="statistics-title" style="font-size: 2rem; margin-bottom: 1rem;">ðŸ“Š Analizza i Dati!</h3>
                    <p style="font-size: 1.3rem; margin-bottom: 2rem;">Studia il grafico a barre e rispondi alla domanda</p>
                    
                    <div id="statistics-chart" class="chart-container">
                        <!-- Chart bars will be generated here -->
                    </div>
                    
                    <div style="background: #F0F9FF; padding: 2rem; border-radius: 1rem; margin: 2rem 0;">
                        <h4 style="font-size: 1.5rem; margin-bottom: 1rem;">â“ Domanda:</h4>
                        <p id="statistics-question" style="font-size: 1.3rem; margin-bottom: 1rem;">
                            Quale categoria ha piÃ¹ voti?
                        </p>
                        <input type="text" id="statistics-input" style="font-size: 1.5rem; padding: 1rem; border: 3px solid #3B82F6; border-radius: 1rem; text-align: center; width: 200px;" placeholder="Risposta...">
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <button class="game-btn" onclick="checkStatisticsAnswer()">ðŸ“Š Analizza!</button>
                        <button class="game-btn secondary" onclick="generateStatisticsChallenge()">ðŸ”„ Nuovi Dati</button>
                    </div>
                    <div id="statistics-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Projects Game -->
        <div id="projects-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸŽ® Crea il Tuo Gioco</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="projects-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="projects-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="project-name" style="font-size: 2rem; margin-bottom: 1rem;">ðŸŽ® Gioco del Memory</h3>
                    <p style="font-size: 1.3rem; margin-bottom: 2rem;">Sviluppa un progetto software step-by-step!</p>
                    
                    <div style="background: #F3F4F6; padding: 1.5rem; border-radius: 1rem; margin: 2rem 0;">
                        <h4 style="font-size: 1.3rem; margin-bottom: 1rem;">ðŸ“ˆ Progresso Progetto:</h4>
                        <div id="project-progress" class="project-progress">
                            <div id="progress-fill" class="progress-fill" style="width: 20%;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 0.5rem; font-size: 1.1rem; font-weight: bold;">
                            Step <span id="current-step">1</span> di <span id="total-steps">5</span>
                        </div>
                    </div>
                    
                    <div id="project-steps" class="project-steps">
                        <!-- Project steps will be generated here -->
                    </div>
                    
                    <div style="background: #FEF3C7; padding: 2rem; border-radius: 1rem; margin: 2rem 0;">
                        <div style="font-size: 3rem; text-align: center; margin-bottom: 1rem;" id="current-step-icon">ðŸŽ¨</div>
                        <h4 style="font-size: 1.5rem; text-align: center; margin-bottom: 1rem;" id="current-step-name">Progettazione</h4>
                        <p style="font-size: 1.1rem; text-align: center;" id="current-step-description">Stai progettando l'interfaccia utente del gioco...</p>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <button class="game-btn" onclick="advanceProjectStep()">âš¡ Completa Step</button>
                        <button class="game-btn secondary" onclick="generateProjectChallenge()">ðŸ”„ Nuovo Progetto</button>
                    </div>
                    <div id="project-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Collaboration Game -->
        <div id="collaboration-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ¤ Coding di Squadra</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="collaboration-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="collaboration-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="collaboration-project" style="font-size: 2rem; margin-bottom: 1rem;">ðŸŒ Sito Web della Scuola</h3>
                    <p style="font-size: 1.3rem; margin-bottom: 2rem;">Collabora con il team per completare il progetto!</p>
                    
                    <div id="team-roles" class="team-roles">
                        <!-- Team roles will be generated here -->
                    </div>
                    
                    <div style="background: #F0F9FF; padding: 2rem; border-radius: 1rem; margin: 2rem 0;">
                        <div style="font-size: 3rem; text-align: center; margin-bottom: 1rem;" id="current-role-icon">ðŸŽ¨</div>
                        <h4 style="font-size: 1.5rem; text-align: center; margin-bottom: 1rem;">
                            Tu stai lavorando come: <span id="current-role-name">Designer</span>
                        </h4>
                        <p style="font-size: 1.1rem; text-align: center; margin-bottom: 1rem;" id="current-role-description">
                            Stai creando mockup e interfacce belle da vedere...
                        </p>
                    </div>
                    
                    <div id="team-chat" class="chat-simulation">
                        <h4 style="font-size: 1.2rem; margin-bottom: 1rem; color: #0284C7;">ðŸ’¬ Chat del Team:</h4>
                        <div id="chat-messages">
                            <!-- Chat messages will be generated here -->
                        </div>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <button class="game-btn" onclick="advanceCollaborationStep()">ðŸ¤ Passa al Prossimo Ruolo</button>
                        <button class="game-btn secondary" onclick="generateCollaborationChallenge()">ðŸ”„ Nuovo Team Project</button>
                    </div>
                    <div id="collaboration-feedback" class="feedback"></div>
                </div>
            </div>

                <div class="classes-grid">
                    <div class="class-card" onclick="selectClass(1)">
                        <div class="card-emoji">ðŸŒ±</div>
                        <h3 class="card-title">Classe 1Âª</h3>
                        <p class="card-description">I primi passi nel mondo digitale (6-7 anni)</p>
                        <div class="card-badges">
                            <span class="badge math">Conteggio</span>
                            <span class="badge coding">Robot</span>
                            <span class="badge thinking">Pattern</span>
                        </div>
                        <div style="color: #059669; font-weight: bold;">âœ… 4 Giochi attivi</div>
                    </div>

                    <div class="class-card" onclick="selectClass(2)">
                        <div class="card-emoji">ðŸŒ¿</div>
                        <h3 class="card-title">Classe 2Âª</h3>
                        <p class="card-description">Piccoli programmatori crescono (7-8 anni)</p>
                        <div class="card-badges">
                            <span class="badge math">Tabelline</span>
                            <span class="badge coding">Loop</span>
                            <span class="badge thinking">Se-Allora</span>
                        </div>
                        <div style="color: #059669; font-weight: bold;">âœ… 3 Giochi attivi</div>
                    </div>

                    <div class="class-card" onclick="selectClass(3)">
                        <div class="card-emoji">ðŸŒ³</div>
                        <h3 class="card-title">Classe 3Âª</h3>
                        <p class="card-description">Logica in azione (8-9 anni)</p>
                        <div class="card-badges">
                            <span class="badge math">Tabelline</span>
                            <span class="badge coding">Algoritmi</span>
                            <span class="badge thinking">Debug</span>
                        </div>
                        <div style="color: #059669; font-weight: bold;">âœ… 3 Giochi attivi</div>
                    </div>

                    <div class="class-card" onclick="selectClass(4)">
                        <div class="card-emoji">ðŸŒ²</div>
                        <h3 class="card-title">Classe 4Âª</h3>
                        <p class="card-description">Algoritmi avanzati (9-10 anni)</p>
                        <div class="card-badges">
                            <span class="badge math">Frazioni</span>
                            <span class="badge coding">Variabili</span>
                            <span class="badge thinking">Ottimizzazione</span>
                        </div>
                        <div style="color: #059669; font-weight: bold;">âœ… 3 Giochi attivi</div>
                    </div>

                    <div class="class-card" onclick="selectClass(5)">
                        <div class="card-emoji">ðŸŒº</div>
                        <h3 class="card-title">Classe 5Âª</h3>
                        <p class="card-description">Programmatori junior (10-11 anni)</p>
                        <div class="card-badges">
                            <span class="badge math">Statistiche</span>
                            <span class="badge coding">Progetti</span>
                            <span class="badge thinking">Collaborazione</span>
                        </div>
                        <div style="color: #059669; font-weight: bold;">âœ… 3 Giochi attivi</div>
                    </div>
                </div>

                <!-- Info Project -->
                <div style="background: linear-gradient(135deg, white 0%, #EFF6FF 100%); border-radius: 2rem; padding: 3rem; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h3 style="font-size: 2rem; color: #1F2937; margin-bottom: 1rem;">ðŸš€ EduTech Lab Platform</h3>
                        <p style="color: #6B7280; max-width: 600px; margin: 0 auto;">
                            Piattaforma integrata per lo sviluppo del pensiero computazionale nella scuola primaria.
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; text-align: center;">
                        <div>
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); border-radius: 1rem; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 2rem;">ðŸ§®</div>
                            <h4 style="color: #2563EB; font-size: 1.2rem; margin-bottom: 0.5rem;">Matematica</h4>
                            <p style="color: #6B7280; font-size: 0.9rem;">Conteggio, operazioni e problem solving</p>
                        </div>
                        <div>
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 1rem; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 2rem;">ðŸ’»</div>
                            <h4 style="color: #059669; font-size: 1.2rem; margin-bottom: 0.5rem;">Coding</h4>
                            <p style="color: #6B7280; font-size: 0.9rem;">Algoritmi, sequenze e robotica educativa</p>
                        </div>
                        <div>
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%); border-radius: 1rem; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 2rem;">ðŸ§ </div>
                            <h4 style="color: #7C3AED; font-size: 1.2rem; margin-bottom: 0.5rem;">Pensiero Computazionale</h4>
                            <p style="color: #6B7280; font-size: 0.9rem;">Pattern recognition e debugging</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CLASS VIEW -->
        <div id="class-view" class="view hidden">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <button class="nav-btn" onclick="showHomepage()">ðŸ  Tutte le Classi</button>
                    <div id="class-stats" class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="class-stars">0</span> stelle</div>
                        <div class="stat-item stat-score">ðŸ† <span id="class-score">0</span> punti</div>
                        <div class="stat-item stat-level">ðŸ§  Livello <span id="class-level">1</span></div>
                    </div>
                    <button class="nav-btn reset-btn" onclick="resetProgress()">ðŸ”„ Reset</button>
                </div>

                <header class="header">
                    <h1 id="class-title">ðŸŒ± Classe 1Âª - Prima Primaria</h1>
                    <p id="class-description">I primi passi nel mondo digitale</p>
                </header>

                <div class="categories-grid">
                    <div class="category-card" onclick="selectCategory('matematica')">
                        <div class="card-emoji">ðŸ§®</div>
                        <h3 class="card-title">Matematica</h3>
                        <p class="card-description">Conteggio, operazioni e problem solving</p>
                        <div id="math-games-count" style="color: #059669; font-weight: bold;">âœ… 2 giochi attivi</div>
                    </div>

                    <div class="category-card" onclick="selectCategory('coding')">
                        <div class="card-emoji">ðŸ’»</div>
                        <h3 class="card-title">Coding</h3>
                        <p class="card-description">Sequenze, algoritmi e programmazione</p>
                        <div id="coding-games-count" style="color: #059669; font-weight: bold;">âœ… 1 giochi attivi</div>
                    </div>

                    <div class="category-card" onclick="selectCategory('pensiero')">
                        <div class="card-emoji">ðŸ§ </div>
                        <h3 class="card-title">Pensiero Computazionale</h3>
                        <p class="card-description">Pattern, debugging e decomposizione</p>
                        <div id="thinking-games-count" style="color: #059669; font-weight: bold;">âœ… 1 giochi attivi</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CATEGORY VIEW -->
        <div id="category-view" class="view hidden">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <button class="nav-btn" onclick="backToClass()">â† Menu Classe</button>
                    <h2 id="category-title" style="font-size: 2rem; font-weight: bold;">ðŸ§® Matematica</h2>
                    <div></div>
                </div>

                <div id="games-container" class="games-grid">
                    <!-- Games will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- GAME SCREENS -->
        <!-- Math Game -->
        <div id="math-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title" id="math-game-title">ðŸ§® Matematica Magica</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="math-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="math-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <div id="math-question" class="question">2 + 3 = ?</div>
                    <div id="math-visual" class="visual-objects">
                        <!-- Visual objects will be populated by JavaScript -->
                    </div>
                    <div class="input-area">
                        <input type="number" id="math-input" class="game-input" placeholder="?">
                        <button class="game-btn" onclick="checkMathAnswer()">âœ… Controlla</button>
                        <button class="game-btn secondary" onclick="generateMathQuestion()">ðŸ”„ Nuova</button>
                    </div>
                    <div id="math-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Counting Game -->
        <div id="counting-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ”¢ Conteggio Magico</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="counting-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="counting-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem;">Conta tutti gli oggetti!</h3>
                    <div id="counting-field" style="position: relative; width: 100%; height: 300px; background: #F3F4F6; border-radius: 1rem; margin: 2rem 0;">
                        <!-- Objects will be positioned here -->
                    </div>
                    <div class="input-area">
                        <input type="number" id="counting-input" class="game-input" placeholder="?">
                        <button class="game-btn" onclick="checkCountingAnswer()">âœ… Ho Contato!</button>
                        <button class="game-btn secondary" onclick="generateCountingChallenge()">ðŸ”„ Nuovi Oggetti</button>
                    </div>
                    <div id="counting-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Pattern Game -->
        <div id="pattern-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸŒˆ Trova il Pattern</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="pattern-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="pattern-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem;">Completa il Pattern!</h3>
                    <div id="pattern-sequence" class="pattern-sequence">
                        <!-- Pattern will be shown here -->
                    </div>
                    <p style="font-size: 1.5rem; margin: 2rem 0;">Quale forma viene dopo?</p>
                    <div id="pattern-options" class="pattern-options">
                        <!-- Options will be shown here -->
                    </div>
                    <button class="game-btn secondary" onclick="generatePattern()">ðŸ”„ Nuovo Pattern</button>
                    <div id="pattern-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Sequence Game -->
        <div id="sequence-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ“ Sequenze Narrative</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="sequence-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="sequence-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="sequence-title" style="font-size: 2rem; margin-bottom: 2rem;">La giornata di Marco</h3>
                    <div style="margin-bottom: 2rem;">
                        <h4 style="font-size: 1.3rem; margin-bottom: 1rem;">La tua sequenza:</h4>
                        <div id="user-sequence" class="sequence-area">
                            <div class="sequence-items">
                                <div style="color: #6B7280; font-style: italic;">Inizia a ordinare...</div>
                            </div>
                        </div>
                    </div>
                    <h4 style="font-size: 1.3rem; margin-bottom: 1rem;">Clicca nell'ordine giusto:</h4>
                    <div id="sequence-options" class="sequence-options">
                        <!-- Options will be populated here -->
                    </div>
                    <button class="game-btn secondary" onclick="generateSequenceStory()">ðŸ”„ Nuova Storia</button>
                    <div id="sequence-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- NEW GAMES - FASE 2 -->
        
        <!-- Loop Game -->
        <div id="loop-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ”„ I Miei Primi Loop</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="loop-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="loop-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="loop-challenge-title" style="font-size: 2rem; margin-bottom: 2rem;">Fai saltare la rana 3 volte!</h3>
                    <div style="font-size: 4rem; margin: 2rem 0;" id="loop-character">ðŸ¸</div>
                    <p style="font-size: 1.5rem; margin: 1rem 0;">Programma il loop:</p>
                    <div id="loop-solution" class="loop-area">
                        <div class="loop-commands">
                            <div style="color: #6B7280; font-style: italic;">Inizia a programmare...</div>
                        </div>
                    </div>
                    <div id="loop-buttons" class="command-buttons">
                        <button class="game-btn" onclick="addLoopCommand('salta')">ðŸ¸ Salta</button>
                        <button class="game-btn" onclick="addLoopCommand('vola')">ðŸ¦ Vola</button>
                        <button class="game-btn" onclick="addLoopCommand('corri')">ðŸƒ Corri</button>
                    </div>
                    <div style="margin: 1rem 0;">
                        <button class="game-btn" onclick="checkLoopSolution()">âœ… Esegui Loop</button>
                        <button class="game-btn red" onclick="clearLoopSolution()">ðŸ—‘ï¸ Cancella</button>
                        <button class="game-btn secondary" onclick="generateLoopChallenge()">ðŸ”„ Nuova Sfida</button>
                    </div>
                    <div id="loop-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- If-Then Game -->
        <div id="if-then-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸš¦ Se Allora</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="if-then-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="if-then-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem;">Cosa faresti SE...?</h3>
                    <div id="if-condition" class="condition-card">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">â›ˆï¸</div>
                        <h4 style="font-size: 1.8rem;">SE piove forte...</h4>
                    </div>
                    <h4 style="font-size: 1.5rem; margin: 2rem 0;">ALLORA...</h4>
                    <div id="then-options" class="then-options">
                        <!-- Options will be populated here -->
                    </div>
                    <button class="game-btn secondary" onclick="generateIfThenChallenge()">ðŸ”„ Nuova Situazione</button>
                    <div id="if-then-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Tabelline Complete Game -->
        <div id="tabelline-complete-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸŽ¯ Tabelline Master</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="tabelline-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="tabelline-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <div id="tabelline-question" class="question">7 Ã— 8 = ?</div>
                    <div style="font-size: 1.5rem; margin: 1rem 0;" id="tabelline-info">Tabellina del 7</div>
                    <div id="tabelline-visual" class="visual-objects">
                        <!-- Visual groups will be populated by JavaScript -->
                    </div>
                    <div class="input-area">
                        <input type="number" id="tabelline-input" class="game-input" placeholder="?">
                        <button class="game-btn" onclick="checkTabellinesAnswer()">âœ… Controlla</button>
                        <button class="game-btn secondary" onclick="generateTabellinesQuestion()">ðŸ”„ Nuova</button>
                    </div>
                    <div id="tabelline-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Algorithm Game -->
        <div id="algorithm-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">âš™ï¸ Algoritmi Intelligenti</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="algorithm-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="algorithm-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 id="algorithm-title" style="font-size: 2rem; margin-bottom: 1rem;">Porta il robot al tesoro!</h3>
                    <p id="algorithm-description" style="font-size: 1.2rem; margin-bottom: 2rem;">Programma il robot per raggiungere il tesoro evitando gli ostacoli</p>
                    <div id="algorithm-grid" class="algorithm-grid">
                        <!-- Grid will be populated here -->
                    </div>
                    <div id="algorithm-solution" class="algorithm-solution">
                        <h4 style="font-size: 1.3rem; margin-bottom: 1rem;">Il tuo algoritmo:</h4>
                        <div id="solution-steps" class="solution-steps">
                            <div style="color: #6B7280; font-style: italic;">Inizia a programmare...</div>
                        </div>
                    </div>
                    <div id="algorithm-buttons" class="command-buttons">
                        <button class="game-btn" onclick="addAlgorithmStep('su')">â¬†ï¸ Su</button>
                        <button class="game-btn" onclick="addAlgorithmStep('giÃ¹')">â¬‡ï¸ GiÃ¹</button>
                        <button class="game-btn" onclick="addAlgorithmStep('sinistra')">â¬…ï¸ Sinistra</button>
                        <button class="game-btn" onclick="addAlgorithmStep('destra')">âž¡ï¸ Destra</button>
                    </div>
                    <div style="margin: 1rem 0;">
                        <button class="game-btn" onclick="checkAlgorithmSolution()">âœ… Testa Algoritmo</button>
                        <button class="game-btn red" onclick="clearAlgorithmSolution()">ðŸ—‘ï¸ Cancella</button>
                        <button class="game-btn secondary" onclick="generateAlgorithmChallenge()">ðŸ”„ Nuovo Puzzle</button>
                    </div>
                    <div id="algorithm-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Debug Advanced Game -->
        <div id="debug-advanced-game" class="game-screen">
            <div class="game-header">
                <div class="game-header-content">
                    <button class="nav-btn" onclick="closeGame()">â† Indietro</button>
                    <div class="game-title">ðŸ”§ Debug Master</div>
                    <div class="stats-bar">
                        <div class="stat-item stat-stars">â­ <span id="debug-advanced-stars">0</span></div>
                        <div class="stat-item stat-score">ðŸ† <span id="debug-advanced-score">0</span></div>
                    </div>
                </div>
            </div>
            <div class="game-content">
                <div class="game-area">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem;">ðŸ”§ Trova il Bug Complesso!</h3>
                    <p id="debug-description" style="font-size: 1.3rem; margin-bottom: 2rem;">Questo algoritmo ha un errore logico. Quale comando Ã¨ sbagliato?</p>
                    <div style="background: #FEF3C7; padding: 1.5rem; border-radius: 1rem; margin: 2rem 0;">
                        <div style="font-size: 1.2rem; color: #92400E;">
                            ðŸ’¡ <strong>Suggerimento:</strong> <span id="debug-hint">Pensa a cosa dovrebbe fare ogni comando...</span>
                        </div>
                    </div>
                    <h4 style="font-size: 1.5rem; margin-bottom: 1rem;">Algoritmo da debuggare:</h4>
                    <div id="debug-sequence" class="debug-sequence">
                        <!-- Commands will be populated here -->
                    </div>
                    <button class="game-btn secondary" onclick="generateDebugChallenge()">ðŸ”„ Nuovo Algoritmo</button>
                    <div id="debug-advanced-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <h3>ðŸŽ“ EduTech Lab</h3>
            <p style="margin-bottom: 0.5rem;">Piattaforma di Pensiero Computazionale per la Scuola Primaria</p>
            <p style="font-size: 0.9rem; color: #9CA3AF;">
                Â© 2025 EduTech Lab by <strong style="color: #60A5FA;">Fabio Rizzotto</strong>
            </p>
            <p style="font-size: 0.8rem; color: #9CA3AF;">
                Insegnante | Animatore Digitale | Formatore Docenti | Esperto PNRR
            </p>
        </footer>
    </div>

    <script>
        // Global State Management
        let currentView = 'homepage';
        let selectedClass = 1;
        let selectedCategory = '';
        let currentGame = '';
        
        // Game States
        let score = parseInt(localStorage.getItem('edutech_score') || '0');
        let stars = parseInt(localStorage.getItem('edutech_stars') || '0');
        let level = parseInt(localStorage.getItem('edutech_level') || '1');
        
        // Adaptive Learning System
        let adaptiveData = JSON.parse(localStorage.getItem('edutech_adaptive') || '{"consecutiveCorrect": 0, "consecutiveWrong": 0, "totalQuestions": 0, "correctAnswers": 0, "currentDifficulty": 1}');
        
        // Game-specific states
        let mathQuestion = {};
        let countingData = {};
        let patternData = {};
        let sequenceData = {};
        let loopData = {};
        let ifThenData = {};
        let tabellinesData = {};
        let algorithmData = {};
        let debugData = {};
        let fractionData = {};
        let variableData = {};
        let optimizationData = {};
        let statisticsData = {};
        let projectData = {};
        let collaborationData = {};

        // Classes Data - UPDATED FOR FASE 2
        const classesData = {
            1: {
                name: "Prima Primaria",
                emoji: "ðŸŒ±",
                description: "I primi passi nel mondo digitale",
                age: "6-7 anni",
                games: {
                    matematica: [
                        { id: 'conteggio', name: 'ðŸ”¢ Conteggio Magico', description: 'Conta oggetti e associa al numero', active: true },
                        { id: 'addizioni-visual', name: 'âž• Addizioni Visual', description: 'Somme fino a 10 con oggetti colorati', active: true }
                    ],
                    coding: [
                        { id: 'sequenze-base', name: 'ðŸ“ Prime Sequenze', description: 'Ordinare azioni quotidiane', active: true }
                    ],
                    pensiero: [
                        { id: 'pattern-semplici', name: 'ðŸŒˆ Trova il Pattern', description: 'Riconosci sequenze colorate', active: true }
                    ]
                }
            ];
            
            algorithmData = challenges[Math.floor(Math.random() * challenges.length)];
            algorithmData.userSolution = [];
            
            document.getElementById('algorithm-title').textContent = algorithmData.title;
            document.getElementById('algorithm-description').textContent = algorithmData.description;
            
            updateAlgorithmDisplay();
        }

        function updateAlgorithmDisplay() {
            // Update grid
            const gridEl = document.getElementById('algorithm-grid');
            gridEl.innerHTML = '';
            
            algorithmData.grid.forEach(row => {
                row.forEach(cell => {
                    const cellEl = document.createElement('div');
                    cellEl.className = 'grid-cell';
                    cellEl.textContent = cell;
                    gridEl.appendChild(cellEl);
                });
            });
            
            // Update solution
            const solutionEl = document.getElementById('solution-steps');
            solutionEl.innerHTML = '';
            
            if (algorithmData.userSolution.length === 0) {
                solutionEl.innerHTML = '<div style="color: #6B7280; font-style: italic;">Inizia a programmare...</div>';
            } else {
                algorithmData.userSolution.forEach((step, index) => {
                    const stepEl = document.createElement('div');
                    stepEl.className = 'solution-step';
                    stepEl.innerHTML = `
                        <span>${index + 1}. ${step}</span>
                        <button onclick="removeAlgorithmStep(${index})" style="background: #EF4444; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">Ã—</button>
                    `;
                    solutionEl.appendChild(stepEl);
                });
            }
        }

        function addAlgorithmStep(step) {
            algorithmData.userSolution.push(step);
            updateAlgorithmDisplay();
        }

        function removeAlgorithmStep(index) {
            algorithmData.userSolution.splice(index, 1);
            updateAlgorithmDisplay();
        }

        function clearAlgorithmSolution() {
            algorithmData.userSolution = [];
            updateAlgorithmDisplay();
            document.getElementById('algorithm-feedback').textContent = '';
        }

        function checkAlgorithmSolution() {
            const isCorrect = JSON.stringify(algorithmData.userSolution) === JSON.stringify(algorithmData.solution);
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('algorithm-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'âš™ï¸ Perfetto! Il tuo algoritmo funziona!';
                feedbackEl.className = 'feedback success';
                
                updateScore(30);
                updateStars(4);
                
                setTimeout(() => generateAlgorithmChallenge(), 2000);
            } else {
                feedbackEl.textContent = 'ðŸ¤” L\'algoritmo non Ã¨ corretto. Prova un percorso diverso!';
                feedbackEl.className = 'feedback error';
            }
        }

        // Debug Advanced Game Functions
        function generateDebugChallenge() {
            const challenges = [
                {
                    description: 'Questo algoritmo dovrebbe far arrivare il robot alla meta',
                    hint: 'Controlla se tutti i movimenti sono nella direzione giusta',
                    sequence: [
                        'Inizia',
                        'Vai a destra',
                        'Vai a sinistra', // ERRORE: dovrebbe essere 'Vai a destra'
                        'Vai in basso',
                        'Prendi tesoro'
                    ],
                    errorIndex: 2,
                    correctCommand: 'Vai a destra'
                },
                {
                    description: 'Questo algoritmo dovrebbe contare fino a 5',
                    hint: 'Controlla se la sequenza di numeri Ã¨ corretta',
                    sequence: [
                        'Conta 1',
                        'Conta 2',
                        'Conta 4', // ERRORE: dovrebbe essere 'Conta 3'
                        'Conta 4',
                        'Conta 5'
                    ],
                    errorIndex: 2,
                    correctCommand: 'Conta 3'
                },
                {
                    description: 'Questo algoritmo dovrebbe preparare una pizza',
                    hint: 'Controlla se tutti i passaggi sono nell\'ordine giusto',
                    sequence: [
                        'Prepara impasto',
                        'Cuoci in forno', // ERRORE: dovrebbe essere dopo 'Aggiungi condimenti'
                        'Aggiungi condimenti',
                        'Stendi impasto',
                        'Servi pizza'
                    ],
                    errorIndex: 1,
                    correctCommand: 'Stendi impasto'
                },
                {
                    description: 'Questo algoritmo dovrebbe lavare i denti',
                    hint: 'Controlla se la sequenza delle azioni Ã¨ logica',
                    sequence: [
                        'Prendi spazzolino',
                        'Metti dentifricio',
                        'Sciacqua bocca', // ERRORE: dovrebbe essere dopo 'Spazzola denti'
                        'Spazzola denti',
                        'Riponi spazzolino'
                    ],
                    errorIndex: 2,
                    correctCommand: 'Spazzola denti'
                }
            ];
            
            debugData = challenges[Math.floor(Math.random() * challenges.length)];
            debugData.found = false;
            
            document.getElementById('debug-description').textContent = debugData.description;
            document.getElementById('debug-hint').textContent = debugData.hint;
            
            updateDebugDisplay();
        }

        function updateDebugDisplay() {
            const sequenceEl = document.getElementById('debug-sequence');
            sequenceEl.innerHTML = '';
            
            debugData.sequence.forEach((command, index) => {
                const commandEl = document.createElement('div');
                commandEl.className = 'debug-command';
                if (debugData.found && index === debugData.errorIndex) {
                    commandEl.classList.add('error');
                }
                commandEl.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 0.5rem;">${index + 1}</div>
                    <div>${command}</div>
                `;
                commandEl.onclick = () => checkDebugAnswer(index);
                sequenceEl.appendChild(commandEl);
            });
        }

        function checkDebugAnswer(selectedIndex) {
            const isCorrect = selectedIndex === debugData.errorIndex;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('debug-advanced-feedback');
            
            if (isCorrect) {
                debugData.found = true;
                updateDebugDisplay();
                
                feedbackEl.textContent = `ðŸ”§ Ottimo! Hai trovato l'errore. Il comando corretto Ã¨: "${debugData.correctCommand}"`;
                feedbackEl.className = 'feedback success';
                
                updateScore(25);
                updateStars(4);
                
                setTimeout(() => generateDebugChallenge(), 3000);
            } else {
                feedbackEl.textContent = 'ðŸ¤” Non Ã¨ questo l\'errore. Leggi attentamente tutti i comandi!';
                feedbackEl.className = 'feedback error';
            }
        }
            },
            2: {
                name: "Seconda Primaria",
                emoji: "ðŸŒ¿", 
                description: "Piccoli programmatori crescono",
                age: "7-8 anni",
                games: {
                    matematica: [
                        { id: 'tabelline-base', name: 'âœ–ï¸ Prime Tabelline', description: 'Tabellina del 2, 5 e 10', active: true }
                    ],
                    coding: [
                        { id: 'loop-semplici', name: 'ðŸ”„ I Miei Primi Loop', description: 'Ripeti 3 volte: avanti', active: true }
                    ],
                    pensiero: [
                        { id: 'if-then-base', name: 'ðŸš¦ Se Allora', description: 'Prime condizioni logiche', active: true }
                    ]
                }
            },
            3: {
                name: "Terza Primaria",
                emoji: "ðŸŒ³",
                description: "Logica in azione",
                age: "8-9 anni",
                games: {
                    matematica: [
                        { id: 'tabelline-complete', name: 'ðŸŽ¯ Tabelline Master', description: 'Tutte le tabelline fino a 10', active: true }
                    ],
                    coding: [
                        { id: 'algoritmi-medi', name: 'âš™ï¸ Algoritmi Intelligenti', description: 'Sequenze con condizioni', active: true }
                    ],
                    pensiero: [
                        { id: 'debug-avanzato', name: 'ðŸ”§ Debug Master', description: 'Trova errori in algoritmi complessi', active: true }
                    ]
                }
            },
            4: {
                name: "Quarta Primaria",
                emoji: "ðŸŒ²",
                description: "Algoritmi avanzati",
                age: "9-10 anni",
                games: {
                    matematica: [
                        { id: 'frazioni-visual', name: 'ðŸ• Frazioni Interattive', description: 'Visualizza e opera con le frazioni', active: true }
                    ],
                    coding: [
                        { id: 'variabili-semplici', name: 'ðŸ“¦ Le Mie Prime Variabili', description: 'Contenitori per i dati', active: true }
                    ],
                    pensiero: [
                        { id: 'ottimizzazione', name: 'ðŸƒâ€â™‚ï¸ Algoritmi Veloci', description: 'Come rendere il codice piÃ¹ efficiente', active: true }
                    ]
                }
            },
            5: {
                name: "Quinta Primaria",
                emoji: "ðŸŒº",
                description: "Programmatori junior",
                age: "10-11 anni",
                games: {
                    matematica: [
                        { id: 'statistica-base', name: 'ðŸ“Š I Miei Primi Grafici', description: 'Raccogli e analizza dati', active: true }
                    ],
                    coding: [
                        { id: 'progetti-completi', name: 'ðŸŽ® Crea il Tuo Gioco', description: 'Progetti completi con interfaccia', active: true }
                    ],
                    pensiero: [
                        { id: 'collaborazione-digitale', name: 'ðŸ¤ Coding di Squadra', description: 'Progetti collaborativi online', active: true }
                    ]
                }
            }
        };

        // Initialize App
        function initApp() {
            updateStats();
            
            // Show stats if user has made progress
            if (score > 0 || stars > 0) {
                document.getElementById('stats-bar').style.display = 'flex';
            }
        }

        // Navigation Functions
        function selectClass(classNum) {
            selectedClass = classNum;
            showClassView();
        }

        function showHomepage() {
            hideAllViews();
            document.getElementById('homepage').classList.remove('hidden');
            currentView = 'homepage';
        }

        function showClassView() {
            hideAllViews();
            document.getElementById('class-view').classList.remove('hidden');
            currentView = 'class-view';
            updateClassHeader();
        }

        function selectCategory(category) {
            selectedCategory = category;
            showCategoryView();
        }

        function showCategoryView() {
            hideAllViews();
            document.getElementById('category-view').classList.remove('hidden');
            currentView = 'category-view';
            updateCategoryView();
        }

        function backToClass() {
            showClassView();
        }

        function hideAllViews() {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            document.querySelectorAll('.game-screen').forEach(game => {
                game.style.display = 'none';
            });
        }

        function updateClassHeader() {
            const classInfo = classesData[selectedClass];
            if (classInfo) {
                document.getElementById('class-title').textContent = `${classInfo.emoji} Classe ${selectedClass}Âª - ${classInfo.name}`;
                document.getElementById('class-description').textContent = classInfo.description;
                
                // Update game counts
                document.getElementById('math-games-count').textContent = `âœ… ${classInfo.games.matematica.filter(g => g.active).length} giochi attivi`;
                document.getElementById('coding-games-count').textContent = `âœ… ${classInfo.games.coding.filter(g => g.active).length} giochi attivi`;
                document.getElementById('thinking-games-count').textContent = `âœ… ${classInfo.games.pensiero.filter(g => g.active).length} giochi attivi`;
            }
        }

        function updateCategoryView() {
            const categoryTitles = {
                matematica: 'ðŸ§® Matematica',
                coding: 'ðŸ’» Coding', 
                pensiero: 'ðŸ§  Pensiero Computazionale'
            };
            
            document.getElementById('category-title').textContent = categoryTitles[selectedCategory];
            
            const gamesContainer = document.getElementById('games-container');
            gamesContainer.innerHTML = '';
            
            const classInfo = classesData[selectedClass];
            if (classInfo && classInfo.games[selectedCategory]) {
                classInfo.games[selectedCategory].forEach(game => {
                    const gameCard = document.createElement('div');
                    gameCard.className = `game-card ${!game.active ? 'disabled' : ''}`;
                    if (game.active) {
                        gameCard.onclick = () => startGame(game.id);
                    }
                    
                    gameCard.innerHTML = `
                        <h3 class="card-title">${game.name}</h3>
                        <p class="card-description">${game.description}</p>
                        <div style="color: ${game.active ? '#059669' : '#F59E0B'}; font-weight: bold;">
                            ${game.active ? 'âœ… Funzionante' : 'ðŸ”§ In sviluppo'}
                        </div>
                    `;
                    
                    gamesContainer.appendChild(gameCard);
                });
            }
        }

        // Game Functions
        function startGame(gameId) {
            currentGame = gameId;
            hideAllViews();
            
            switch(gameId) {
                case 'conteggio':
                    document.getElementById('counting-game').style.display = 'flex';
                    generateCountingChallenge();
                    break;
                case 'addizioni-visual':
                    document.getElementById('math-game').style.display = 'flex';
                    document.getElementById('math-game-title').textContent = 'âž• Addizioni Visual';
                    generateMathQuestion();
                    break;
                case 'pattern-semplici':
                    document.getElementById('pattern-game').style.display = 'flex';
                    generatePattern();
                    break;
                case 'sequenze-base':
                    document.getElementById('sequence-game').style.display = 'flex';
                    generateSequenceStory();
                    break;
                case 'tabelline-base':
                    document.getElementById('math-game').style.display = 'flex';
                    document.getElementById('math-game-title').textContent = 'âœ–ï¸ Prime Tabelline';
                    generateMultiplicationQuestion();
                    break;
                // NEW GAMES - FASE 2
                case 'loop-semplici':
                    document.getElementById('loop-game').style.display = 'flex';
                    generateLoopChallenge();
                    break;
                case 'if-then-base':
                    document.getElementById('if-then-game').style.display = 'flex';
                    generateIfThenChallenge();
                    break;
                case 'tabelline-complete':
                    document.getElementById('tabelline-complete-game').style.display = 'flex';
                    generateTabellinesQuestion();
                    break;
                case 'algoritmi-medi':
                    document.getElementById('algorithm-game').style.display = 'flex';
                    generateAlgorithmChallenge();
                    break;
                case 'debug-avanzato':
                    document.getElementById('debug-advanced-game').style.display = 'flex';
                    generateDebugChallenge();
                    break;
                // NEW GAMES - FASE 3
                case 'frazioni-visual':
                    document.getElementById('fractions-game').style.display = 'flex';
                    generateFractionChallenge();
                    break;
                case 'variabili-semplici':
                    document.getElementById('variables-game').style.display = 'flex';
                    generateVariableChallenge();
                    break;
                case 'ottimizzazione':
                    document.getElementById('optimization-game').style.display = 'flex';
                    generateOptimizationChallenge();
                    break;
                case 'statistica-base':
                    document.getElementById('statistics-game').style.display = 'flex';
                    generateStatisticsChallenge();
                    break;
                case 'progetti-completi':
                    document.getElementById('projects-game').style.display = 'flex';
                    generateProjectChallenge();
                    break;
                case 'collaborazione-digitale':
                    document.getElementById('collaboration-game').style.display = 'flex';
                    generateCollaborationChallenge();
                    break;
                default:
                    alert('Gioco in sviluppo - sarÃ  disponibile presto!');
                    showCategoryView();
            }
            
            updateGameStats();
        }

        function closeGame() {
            showCategoryView();
        }

        // Math Game Functions
        function generateMathQuestion() {
            const difficulty = adaptiveData.currentDifficulty;
            let maxNum;
            
            switch(difficulty) {
                case 1: maxNum = 5; break;
                case 2: maxNum = 10; break;
                case 3: maxNum = 15; break;
                default: maxNum = 10;
            }
            
            const a = Math.floor(Math.random() * maxNum) + 1;
            const b = Math.floor(Math.random() * (maxNum - a)) + 1;
            const operation = '+';
            
            mathQuestion = { a, b, operation, result: a + b, difficulty };
            
            document.getElementById('math-question').textContent = `${mathQuestion.a} ${mathQuestion.operation} ${mathQuestion.b} = ?`;
            document.getElementById('math-input').value = '';
            document.getElementById('math-feedback').textContent = '';
            
            generateMathVisual();
        }

        function generateMultiplicationQuestion() {
            const difficulty = adaptiveData.currentDifficulty;
            const tables = difficulty <= 2 ? [2, 5, 10] : [2, 3, 4, 5, 6, 7, 8, 9, 10];
            const table = tables[Math.floor(Math.random() * tables.length)];
            const multiplier = Math.floor(Math.random() * 10) + 1;
            
            mathQuestion = { a: table, b: multiplier, operation: 'Ã—', result: table * multiplier, difficulty };
            
            document.getElementById('math-question').textContent = `${mathQuestion.a} Ã— ${mathQuestion.b} = ?`;
            document.getElementById('math-input').value = '';
            document.getElementById('math-feedback').textContent = '';
            
            generateMultiplicationVisual();
        }

        function generateMathVisual() {
            const visualContainer = document.getElementById('math-visual');
            visualContainer.innerHTML = '';
            
            // Create visual objects for addition
            const colors = ['#3B82F6', '#EF4444'];
            
            for (let i = 0; i < mathQuestion.a; i++) {
                const obj = document.createElement('div');
                obj.className = 'visual-object';
                obj.style.backgroundColor = colors[0];
                obj.textContent = i + 1;
                visualContainer.appendChild(obj);
            }
            
            if (mathQuestion.operation === '+') {
                for (let i = 0; i < mathQuestion.b; i++) {
                    const obj = document.createElement('div');
                    obj.className = 'visual-object';
                    obj.style.backgroundColor = colors[1];
                    obj.textContent = i + 1;
                    visualContainer.appendChild(obj);
                }
            }
        }

        function generateMultiplicationVisual() {
            const visualContainer = document.getElementById('math-visual');
            visualContainer.innerHTML = '';
            
            // Create visual groups for multiplication
            for (let group = 0; group < mathQuestion.b; group++) {
                const groupDiv = document.createElement('div');
                groupDiv.style.display = 'flex';
                groupDiv.style.flexDirection = 'column';
                groupDiv.style.alignItems = 'center';
                groupDiv.style.margin = '0 10px';
                
                const groupLabel = document.createElement('div');
                groupLabel.textContent = `Gruppo ${group + 1}`;
                groupLabel.style.fontSize = '0.8rem';
                groupLabel.style.marginBottom = '5px';
                groupDiv.appendChild(groupLabel);
                
                const groupContainer = document.createElement('div');
                groupContainer.style.display = 'flex';
                groupContainer.style.flexWrap = 'wrap';
                groupContainer.style.maxWidth = '120px';
                groupContainer.style.gap = '2px';
                
                for (let i = 0; i < mathQuestion.a; i++) {
                    const obj = document.createElement('div');
                    obj.style.width = '25px';
                    obj.style.height = '25px';
                    obj.style.backgroundColor = '#F59E0B';
                    obj.style.borderRadius = '50%';
                    obj.style.display = 'flex';
                    obj.style.alignItems = 'center';
                    obj.style.justifyContent = 'center';
                    obj.style.color = 'white';
                    obj.style.fontSize = '0.7rem';
                    obj.textContent = i + 1;
                    groupContainer.appendChild(obj);
                }
                
                groupDiv.appendChild(groupContainer);
                visualContainer.appendChild(groupDiv);
            }
        }

        function checkMathAnswer() {
            const userAnswer = parseInt(document.getElementById('math-input').value);
            const isCorrect = userAnswer === mathQuestion.result;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('math-feedback');
            
            if (isCorrect) {
                const encouragements = [
                    'ðŸŽ‰ Fantastico! Sei bravissimo!',
                    'â­ Perfetto! Continua cosÃ¬!',
                    'ðŸš€ Incredibile! Sei un campione!',
                    'ðŸ† Straordinario! Hai imparato!'
                ];
                
                feedbackEl.textContent = encouragements[Math.floor(Math.random() * encouragements.length)];
                feedbackEl.className = 'feedback success';
                
                updateScore(10 * mathQuestion.difficulty);
                updateStars(mathQuestion.difficulty);
                
                setTimeout(() => {
                    if (currentGame === 'tabelline-base') {
                        generateMultiplicationQuestion();
                    } else {
                        generateMathQuestion();
                    }
                }, 2000);
            } else {
                const supportive = [
                    'ðŸ¤— Non ti preoccupare! Proviamo insieme!',
                    'ðŸ’ª Quasi ci sei! Prova ancora!',
                    'ðŸ˜Š Va benissimo sbagliare, impariamo cosÃ¬!',
                    'ðŸŒŸ Sei coraggioso a provare! Riprova!'
                ];
                
                feedbackEl.textContent = supportive[Math.floor(Math.random() * supportive.length)];
                feedbackEl.className = 'feedback error';
            }
        }

        // Counting Game Functions
        function generateCountingChallenge() {
            const target = Math.min(5 + adaptiveData.currentDifficulty * 2, 20);
            const emojis = ['ðŸ”´', 'ðŸŸ¡', 'ðŸ”µ', 'ðŸŸ¢', 'ðŸŸ£', 'ðŸŸ ', 'â­', 'â¤ï¸', 'ðŸŽˆ', 'ðŸŒ¸', 'ðŸŽ', 'âš½'];
            
            countingData = { target, objects: [] };
            
            const field = document.getElementById('counting-field');
            field.innerHTML = '';
            
            for (let i = 0; i < target; i++) {
                const obj = document.createElement('div');
                obj.style.position = 'absolute';
                obj.style.fontSize = '2rem';
                obj.style.left = (Math.random() * 80 + 10) + '%';
                obj.style.top = (Math.random() * 70 + 15) + '%';
                obj.style.transform = 'translate(-50%, -50%)';
                obj.style.cursor = 'pointer';
                obj.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                
                field.appendChild(obj);
            }
            
            document.getElementById('counting-input').value = '';
            document.getElementById('counting-feedback').textContent = '';
        }

        function checkCountingAnswer() {
            const userAnswer = parseInt(document.getElementById('counting-input').value);
            const isCorrect = userAnswer === countingData.target;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('counting-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'ðŸŽ‰ Perfetto! Hai contato tutto!';
                feedbackEl.className = 'feedback success';
                
                updateScore(5 * adaptiveData.currentDifficulty);
                updateStars(1);
                
                setTimeout(() => generateCountingChallenge(), 2000);
            } else {
                feedbackEl.textContent = 'ðŸ¤— Conta ancora! Tocca ogni oggetto!';
                feedbackEl.className = 'feedback error';
            }
        }

        // Pattern Game Functions
        function generatePattern() {
            const shapes = ['ðŸ”´', 'ðŸŸ¡', 'ðŸ”µ', 'ðŸŸ¢', 'ðŸŸ£'];
            const patternLength = Math.min(3 + level, 5);
            const basePattern = [];
            
            for (let i = 0; i < patternLength; i++) {
                basePattern.push(shapes[i % 3]);
            }
            
            const fullPattern = [...basePattern, ...basePattern, ...basePattern.slice(0, -1)];
            const nextElement = basePattern[basePattern.length - 1];
            
            patternData = { pattern: fullPattern, correct: nextElement };
            
            // Generate options
            const options = [nextElement];
            while (options.length < 3) {
                const randomShape = shapes[Math.floor(Math.random() * shapes.length)];
                if (!options.includes(randomShape)) {
                    options.push(randomShape);
                }
            }
            patternData.options = options.sort(() => Math.random() - 0.5);
            
            displayPattern();
        }

        function displayPattern() {
            const sequenceEl = document.getElementById('pattern-sequence');
            sequenceEl.innerHTML = '';
            
            patternData.pattern.forEach(shape => {
                const item = document.createElement('div');
                item.className = 'pattern-item';
                item.textContent = shape;
                sequenceEl.appendChild(item);
            });
            
            // Add missing item placeholder
            const missing = document.createElement('div');
            missing.className = 'pattern-item missing';
            missing.textContent = '?';
            sequenceEl.appendChild(missing);
            
            // Display options
            const optionsEl = document.getElementById('pattern-options');
            optionsEl.innerHTML = '';
            
            patternData.options.forEach(option => {
                const optionEl = document.createElement('div');
                optionEl.className = 'pattern-option';
                optionEl.textContent = option;
                optionEl.onclick = () => checkPatternAnswer(option);
                optionsEl.appendChild(optionEl);
            });
            
            document.getElementById('pattern-feedback').textContent = '';
        }

        function checkPatternAnswer(selectedOption) {
            const isCorrect = selectedOption === patternData.correct;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('pattern-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'ðŸŒŸ Perfetto! Hai trovato il pattern!';
                feedbackEl.className = 'feedback success';
                
                updateScore(15);
                updateStars(2);
                
                setTimeout(() => generatePattern(), 2000);
            } else {
                feedbackEl.textContent = 'ðŸ¤” Guarda bene... quale forma si ripete?';
                feedbackEl.className = 'feedback error';
            }
        }

        // Sequence Game Functions
        function generateSequenceStory() {
            const stories = [
                {
                    title: 'La giornata di Marco',
                    sequence: ['ðŸ›ï¸ Sveglia', 'ðŸ¦· Lava denti', 'ðŸž Colazione', 'ðŸŽ’ Scuola', 'ðŸ Pranzo', 'ðŸ˜´ Nanna'],
                    scrambled: ['ðŸ Pranzo', 'ðŸ›ï¸ Sveglia', 'ðŸ˜´ Nanna', 'ðŸŽ’ Scuola', 'ðŸ¦· Lava denti', 'ðŸž Colazione']
                },
                {
                    title: 'Preparare i biscotti',
                    sequence: ['ðŸ¥š Uova', 'ðŸ¥› Latte', 'ðŸ¥„ Mescola', 'ðŸ”¥ Cuoci', 'ðŸª Biscotti'],
                    scrambled: ['ðŸª Biscotti', 'ðŸ¥„ Mescola', 'ðŸ¥š Uova', 'ðŸ”¥ Cuoci', 'ðŸ¥› Latte']
                }
            ];
            
            sequenceData = stories[Math.floor(Math.random() * stories.length)];
            sequenceData.userOrder = [];
            
            document.getElementById('sequence-title').textContent = sequenceData.title;
            updateSequenceDisplay();
        }

        function updateSequenceDisplay() {
            const userSequenceEl = document.getElementById('user-sequence').querySelector('.sequence-items');
            userSequenceEl.innerHTML = '';
            
            if (sequenceData.userOrder.length === 0) {
                userSequenceEl.innerHTML = '<div style="color: #6B7280; font-style: italic;">Inizia a ordinare...</div>';
            } else {
                sequenceData.userOrder.forEach((item, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'sequence-item';
                    itemEl.innerHTML = `<span style="background: #EFF6FF; padding: 0.2rem 0.5rem; border-radius: 50%; font-size: 0.8rem;">${index + 1}</span>${item}`;
                    userSequenceEl.appendChild(itemEl);
                });
            }
            
            // Update options (show only unselected items)
            const optionsEl = document.getElementById('sequence-options');
            optionsEl.innerHTML = '';
            
            sequenceData.scrambled.filter(item => !sequenceData.userOrder.includes(item)).forEach(item => {
                const optionEl = document.createElement('div');
                optionEl.className = 'sequence-option';
                optionEl.textContent = item;
                optionEl.onclick = () => addToSequence(item);
                optionsEl.appendChild(optionEl);
            });
        }

        function addToSequence(item) {
            sequenceData.userOrder.push(item);
            updateSequenceDisplay();
            
            if (sequenceData.userOrder.length === sequenceData.sequence.length) {
                const isCorrect = JSON.stringify(sequenceData.userOrder) === JSON.stringify(sequenceData.sequence);
                updateAdaptiveStats(isCorrect);
                
                const feedbackEl = document.getElementById('sequence-feedback');
                
                if (isCorrect) {
                    feedbackEl.textContent = 'ðŸŒŸ Sequenza perfetta! Sei un ordinatore!';
                    feedbackEl.className = 'feedback success';
                    
                    updateScore(20);
                    updateStars(3);
                    
                    setTimeout(() => generateSequenceStory(), 2000);
                } else {
                    feedbackEl.textContent = 'ðŸ¤” Pensa all\'ordine giusto... cosa succede prima?';
                    feedbackEl.className = 'feedback error';
                    sequenceData.userOrder = [];
                    setTimeout(() => updateSequenceDisplay(), 1000);
                }
            }
        }

        // NEW GAME FUNCTIONS - FASE 2

        // Loop Game Functions
        function generateLoopChallenge() {
            const challenges = [
                {
                    title: 'Fai saltare la rana 3 volte!',
                    character: 'ðŸ¸',
                    action: 'salta',
                    times: 3
                },
                {
                    title: 'Fai volare l\'uccello 4 volte!',
                    character: 'ðŸ¦',
                    action: 'vola',
                    times: 4
                },
                {
                    title: 'Fai correre il coniglio 5 volte!',
                    character: 'ðŸ°',
                    action: 'corri',
                    times: 5
                }
            ];
            
            loopData = challenges[Math.floor(Math.random() * challenges.length)];
            loopData.solution = [];
            
            document.getElementById('loop-challenge-title').textContent = loopData.title;
            document.getElementById('loop-character').textContent = loopData.character;
            updateLoopDisplay();
        }

        function updateLoopDisplay() {
            const solutionEl = document.getElementById('loop-solution').querySelector('.loop-commands');
            solutionEl.innerHTML = '';
            
            if (loopData.solution.length === 0) {
                solutionEl.innerHTML = '<div style="color: #6B7280; font-style: italic;">Inizia a programmare...</div>';
            } else {
                loopData.solution.forEach((command, index) => {
                    const commandEl = document.createElement('div');
                    commandEl.className = 'loop-command';
                    commandEl.innerHTML = `<span>${index + 1}.</span><span>${command}</span>`;
                    solutionEl.appendChild(commandEl);
                });
            }
        }

        function addLoopCommand(command) {
            loopData.solution.push(command);
            updateLoopDisplay();
        }

        function clearLoopSolution() {
            loopData.solution = [];
            updateLoopDisplay();
            document.getElementById('loop-feedback').textContent = '';
        }

        function checkLoopSolution() {
            const isCorrect = loopData.solution.length === loopData.times && 
                             loopData.solution.every(cmd => cmd === loopData.action);
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('loop-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = `ðŸ”„ Perfetto! Hai fatto ripetere l'azione ${loopData.times} volte!`;
                feedbackEl.className = 'feedback success';
                
                updateScore(25);
                updateStars(3);
                
                setTimeout(() => generateLoopChallenge(), 2000);
            } else {
                feedbackEl.textContent = `ðŸ¤” Ripeti sempre "${loopData.action}" per ${loopData.times} volte!`;
                feedbackEl.className = 'feedback error';
            }
        }

        // If-Then Game Functions
        function generateIfThenChallenge() {
            const challenges = [
                {
                    condition: 'â›ˆï¸ SE piove forte...',
                    emoji: 'â›ˆï¸',
                    options: [
                        'ðŸ  Resto a casa',
                        'ðŸ–ï¸ Vado al mare', 
                        'ðŸŒž Prendo il sole'
                    ],
                    correct: 0
                },
                {
                    condition: 'ðŸ”¥ SE c\'Ã¨ un incendio...',
                    emoji: 'ðŸ”¥',
                    options: [
                        'ðŸ’§ Chiamo i pompieri',
                        'ðŸ“¸ Faccio una foto',
                        'ðŸ¿ Guardo lo spettacolo'
                    ],
                    correct: 0
                },
                {
                    condition: 'ðŸŽ SE ho fame...',
                    emoji: 'ðŸŽ',
                    options: [
                        'ðŸŽ® Gioco ai videogame',
                        'ðŸ• Mangio qualcosa',
                        'ðŸ˜´ Vado a dormire'
                    ],
                    correct: 1
                },
                {
                    condition: 'ðŸ˜´ SE sono stanco...',
                    emoji: 'ðŸ˜´',
                    options: [
                        'ðŸƒ Vado a correre',
                        'ðŸ›ï¸ Vado a riposare',
                        'ðŸ“š Studio di piÃ¹'
                    ],
                    correct: 1
                }
            ];
            
            ifThenData = challenges[Math.floor(Math.random() * challenges.length)];
            
            const conditionEl = document.getElementById('if-condition');
            conditionEl.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 1rem;">${ifThenData.emoji}</div>
                <h4 style="font-size: 1.8rem;">${ifThenData.condition}</h4>
            `;
            
            const optionsEl = document.getElementById('then-options');
            optionsEl.innerHTML = '';
            
            ifThenData.options.forEach((option, index) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'then-option';
                optionEl.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 1rem;">${option.split(' ')[0]}</div>
                    <div style="font-size: 1.2rem; font-weight: bold;">${option.split(' ').slice(1).join(' ')}</div>
                `;
                optionEl.onclick = () => checkIfThenAnswer(index);
                optionsEl.appendChild(optionEl);
            });
            
            document.getElementById('if-then-feedback').textContent = '';
        }

        function checkIfThenAnswer(selectedIndex) {
            const isCorrect = selectedIndex === ifThenData.correct;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('if-then-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'ðŸ§  Perfetto! Hai scelto la conseguenza logica!';
                feedbackEl.className = 'feedback success';
                
                updateScore(20);
                updateStars(2);
                
                setTimeout(() => generateIfThenChallenge(), 2000);
            } else {
                feedbackEl.textContent = 'ðŸ¤” Pensa meglio... cosa faresti davvero in questa situazione?';
                feedbackEl.className = 'feedback error';
            }
        }

        // Tabellines Complete Game Functions
        function generateTabellinesQuestion() {
            const difficulty = Math.min(adaptiveData.currentDifficulty + 2, 5); // More challenging
            const allTables = [2, 3, 4, 5, 6, 7, 8, 9, 10];
            const table = allTables[Math.floor(Math.random() * allTables.length)];
            const multiplier = Math.floor(Math.random() * 10) + 1;
            
            tabellinesData = { table, multiplier, result: table * multiplier, difficulty };
            
            document.getElementById('tabelline-question').textContent = `${table} Ã— ${multiplier} = ?`;
            document.getElementById('tabelline-info').textContent = `Tabellina del ${table}`;
            document.getElementById('tabelline-input').value = '';
            document.getElementById('tabelline-feedback').textContent = '';
            
            generateTabellinesVisual();
        }

        function generateTabellinesVisual() {
            const visualContainer = document.getElementById('tabelline-visual');
            visualContainer.innerHTML = '';
            
            // Show fewer groups for readability on harder tables
            const showGroups = Math.min(tabellinesData.multiplier, 6);
            
            for (let group = 0; group < showGroups; group++) {
                const groupDiv = document.createElement('div');
                groupDiv.style.display = 'flex';
                groupDiv.style.flexDirection = 'column';
                groupDiv.style.alignItems = 'center';
                groupDiv.style.margin = '0 8px';
                
                const groupLabel = document.createElement('div');
                groupLabel.textContent = `Gruppo ${group + 1}`;
                groupLabel.style.fontSize = '0.7rem';
                groupLabel.style.marginBottom = '3px';
                groupDiv.appendChild(groupLabel);
                
                const groupContainer = document.createElement('div');
                groupContainer.style.display = 'flex';
                groupContainer.style.flexWrap = 'wrap';
                groupContainer.style.maxWidth = '80px';
                groupContainer.style.gap = '1px';
                
                for (let i = 0; i < Math.min(tabellinesData.table, 8); i++) {
                    const obj = document.createElement('div');
                    obj.style.width = '18px';
                    obj.style.height = '18px';
                    obj.style.backgroundColor = '#8B5CF6';
                    obj.style.borderRadius = '50%';
                    obj.style.display = 'flex';
                    obj.style.alignItems = 'center';
                    obj.style.justifyContent = 'center';
                    obj.style.color = 'white';
                    obj.style.fontSize = '0.6rem';
                    obj.textContent = i + 1;
                    groupContainer.appendChild(obj);
                }
                
                groupDiv.appendChild(groupContainer);
                visualContainer.appendChild(groupDiv);
            }
            
            if (tabellinesData.multiplier > 6) {
                const moreDiv = document.createElement('div');
                moreDiv.style.fontSize = '1.2rem';
                moreDiv.style.color = '#8B5CF6';
                moreDiv.style.margin = '0 10px';
                moreDiv.textContent = `... e altri ${tabellinesData.multiplier - 6} gruppi`;
                visualContainer.appendChild(moreDiv);
            }
        }

        function checkTabellinesAnswer() {
            const userAnswer = parseInt(document.getElementById('tabelline-input').value);
            const isCorrect = userAnswer === tabellinesData.result;
            
            updateAdaptiveStats(isCorrect);
            
            const feedbackEl = document.getElementById('tabelline-feedback');
            
            if (isCorrect) {
                feedbackEl.textContent = 'âš¡ Fantastico! Sei un master delle tabelline!';
                feedbackEl.className = 'feedback success';
                
                updateScore(15 * tabellinesData.difficulty);
                updateStars(3);
                
                setTimeout(() => generateTabellinesQuestion(), 1500);
            } else {
                feedbackEl.textContent = 'ðŸ’ª Quasi! Conta tutti gli oggetti nei gruppi!';
                feedbackEl.className = 'feedback error';
            }
        }

        // Algorithm Game Functions
        function generateAlgorithmChallenge() {
            const challenges = [
                {
                    title: 'Porta il robot al tesoro!',
                    description: 'Programma il robot per raggiungere il tesoro',
                    grid: [
                        ['ðŸ¤–', '', ''],
                        ['', 'ðŸª¨', ''],
                        ['', '', 'ðŸ†']
                    ],
                    start: [0, 0],
                    target: [2, 2],
                    obstacles: [[1, 1]],
                    solution: ['destra', 'destra', 'giÃ¹', 'giÃ¹']
                },
                {
                    title: 'Raccogli la stella!',
                    description: 'Evita gli ostacoli e raggiungi la stella',
                    grid: [
                        ['ðŸ¤–', 'ðŸª¨', ''],
                        ['', '', 'â­'],
                        ['ðŸª¨', '', '']
                    ],
                    start: [0, 0],
                    target: [1, 2],
                    obstacles: [[0, 1], [2, 0]],
                    solution: ['giÃ¹', 'destra', 'destra', 'su']
                },
                {
                    title: 'Trova la chiave!',
                    description: 'Naviga attraverso il labirinto',
                    grid: [
                        ['ðŸ¤–', '', 'ðŸª¨'],
                        ['ðŸª¨', '', ''],
                        ['', '', 'ðŸ—ï¸']
                    ],
                    start: [0, 0],
                    target: [2, 2],
                    obstacles: [[0, 2], [1, 0]],
                    solution: ['destra', 'giÃ¹', 'giÃ¹', 'destra']
                }
